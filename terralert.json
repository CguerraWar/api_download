{"version": "1.0", "files": [{"patch": "main.py", "content": "ZnJvbSBtYWNoaW5lIGltcG9ydCBQaW4sIHVuaXF1ZV9pZCwgVUFSVAppbXBvcnQgdGltZQppbXBvcnQgdWFzeW5jaW8KZnJvbSBzcmMubGlicy5TaW03NjAwRHJpdmVyIGltcG9ydCBTaW03NjAwRGlydmVyCmZyb20gc3JjLmxpYnMuT1RBX1Byb2dyYW1tZXIgaW1wb3J0IE90YVByb2dyYW1tZXIKCnRpbWUuc2xlZXAoMykKcHJpbnQoIkluaWNpbyBkZSBwcm9ncmFtYSBlbi4uLiIpCnRpbWUuc2xlZXAoMSkKCiNQYXJhIHF1ZSBvdGEgZnVuY2lvbmUgdGFudG8gbGEgdmVyc2lvbiBkZSBlbjogT3RhUHJvZ3JhbW1lcigpIC0+aW5pdCBjb21vIGxhIGRlIGVsIGdpdGh1YiBqc29uIGRlYmVuIGNvaW5jaWRpciBwYXJhIHEgbm8gc2UgZXN0ZSBldGVybmFtZW50ZSByZXByb2dyYW1hbmRvCm90YSA9IE90YVByb2dyYW1tZXIoMCwgMTE1MjAwLCAnMS4wJywgImh0dHBzOi8vY2d1ZXJyYXdhci5naXRodWIuaW8vYXBpX2Rvd25sb2FkL3RlcnJhbGVydC5qc29uIiApCgphc3luYyBkZWYgbWFpbigpOgoKICAgIHVhc3luY2lvLmNyZWF0ZV90YXNrKG90YS5UYXNrRm9ySXNOZWVkVG9Qcm9ncmFtKCkpICAjIEVzIHBvc2libGUgcXVlIHNlYSBtYW51YWwgbGEgdmVyaWZpY2FjaW9uIGRlIHZlcnNpb24sIGVuIHRhbCBjYXNvIGxsYW1hciBkaXJlY3RhbWVudGUgOiBhd2FpdCBUYXNrRm9ySXNOZWVkVG9Qcm9ncmFtKCkgY3VhbmRvIHNlIHJlcXVpZXJhCgogICAgd2hpbGUgIG90YS5Jc0dvb2RWZXJzaW9uKCkgPT0gRmFsc2U6CiAgICAgICAgcHJpbnQoJ0NvbWllbnpvIGEgY29ycmVyIG1pcyB0YXJlYXMgcHJpbmNpcGFsZXMgZGVzcHVlcyBxIHZlcmlmaXF1ZSBxdWUgbm8gbmVjZXNpdG8gcmVwcm9ncmFtYXIgbWkgdmVyc2lvbiBkZSBwcm9ncmFtYSAnKQogICAgICAgIAogICAgICAgIGF3YWl0IHVhc3luY2lvLnNsZWVwX21zKDUwMDApCiAgICAKICAgICN1YXN5bmNpby5jcmVhdGVfdGFzayhUYXNrX3h4eHh4eHh4KSB0YXJlYXMgIHByaW5jaXBhbGVzIHkgbG9vcCBhIGxhIGVzcGVyYQoKICAgIHdoaWxlIFRydWU6CiAgICAgIAogICAgICAgIHByaW50KCdNYWluIHByb2dyYW0uLi4uICcpCiAgICAKICAgICAgICBhd2FpdCB1YXN5bmNpby5zbGVlcF9tcyg1MDAwKQoKdWFzeW5jaW8ucnVuKG1haW4oKSkKCgojIGZyb20gbWFjaGluZSBpbXBvcnQgUGluLCB1bmlxdWVfaWQsIFVBUlQKIyB1YXJ0ID0gVUFSVCgwKSAgI21vZGVtCiMgdWFydC5pbml0KDExNTIwMCwgcnhidWY9MjAyNCwgdGltZW91dD0xMDAsIHRpbWVvdXRfY2hhcj01MCkKIyB1YXJ0LndyaXRlKCJBVCtIVFRQSU5JVFxyXG4iKQojIHVhcnQud3JpdGUoIkFUK0NHUEFERFJcclxuIikKIyB1cmw9ICJodHRwOi8vbXktanNvbi1zZXJ2ZXIudHlwaWNvZGUuY29tL0NndWVycmFXYXIvYXBpX2Rvd25sb2FkL2RiIgojIHVybD0gImh0dHA6Ly9hcGkud29ybGRiYW5rLm9yZy92Mi9lbi9pbmRpY2F0b3IvTlkuR0RQLk1LVFAuQ0Q/ZG93bmxvYWRmb3JtYXQ9Y3N2IgojIHVybD0gImh0dHBzOi8vY2d1ZXJyYXdhci5naXRodWIuaW8vYXBpX2Rvd25sb2FkL2RiLmpzb24iCiMgcGFyYW0gPSBmJz0iVVJMIiwie3VybH0iJwojIyMjIyMgcHJpbnQoZiJcclxuRWplY3V0YXIgQ29tYW5kbyBBVCtIVFRQUEFSQXtwYXJhbX0iKQojIHVhcnQud3JpdGUoZiJBVCtIVFRQUEFSQXtwYXJhbX1cclxuIikKIyB1YXJ0LndyaXRlKGYiQVQrSFRUUEFDVElPTj0wXHJcbiIpCiMgdWFydC53cml0ZSgiQVQrSFRUUEhFQURcclxuIikKIyB1YXJ0LndyaXRlKGYiQVQrSFRUUFJFQUQ9MCwyMDI0XHJcbiIpCiMgdWFydC53cml0ZSgiQVQrSFRUUFRFUk1cclxuIikKCiMgdWFydC5yZWFkKCk="}, {"patch": "src/libs/Util.py", "content": "aW1wb3J0IGpzb24KZnJvbSBtYWNoaW5lIGltcG9ydCBQaW4KaW1wb3J0IHV0aW1lCgoKY2xhc3MgQ2lyY3VsYXJCdWZmZXI6CiAgICBkZWYgX19pbml0X18oc2VsZiwgYnVmZmVyU2l6ZSk6CiAgICAgICAgc2VsZi5fX2J1ZmZlciA9IFswXSAqIGJ1ZmZlclNpemUKICAgICAgICBzZWxmLl9fc2l6ZTogaW50ID0gYnVmZmVyU2l6ZQogICAgICAgIHNlbGYuX19pbmRleDogaW50ID0gMAogICAgICAgIHNlbGYuX19jb3VudDogaW50ID0gMAogICAgICAgIHNlbGYuX19zdW06IGZsb2F0ID0gMAoKICAgIGRlZiBHZXRTaXplKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9fc2l6ZQoKICAgIGRlZiBHZXRDb3VudEl0ZW1zKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9fY291bnQKCiAgICBkZWYgQWRkVmFsdWUoc2VsZiwgdmFsdWU6IGZsb2F0KSAtPiBOb25lOgogICAgICAgIGlmIHNlbGYuX19jb3VudCA8IHNlbGYuX19zaXplOgogICAgICAgICAgICBzZWxmLl9fY291bnQgKz0gMQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuX19zdW0gLT0gc2VsZi5fX2J1ZmZlcltzZWxmLl9faW5kZXhdCgogICAgICAgIHNlbGYuX19zdW0gKz0gdmFsdWUKICAgICAgICBzZWxmLl9fYnVmZmVyW3NlbGYuX19pbmRleF0gPSB2YWx1ZQogICAgICAgIHNlbGYuX19pbmRleCA9IChzZWxmLl9faW5kZXggKyAxKSAlIHNlbGYuX19zaXplCgogICAgZGVmIEdldEF2ZXJhZ2Uoc2VsZikgLT4gZmxvYXQ6CiAgICAgICAgaWYgc2VsZi5fX2NvdW50ID09IDA6CiAgICAgICAgICAgIHJldHVybiAwCgogICAgICAgIHJldHVybiBzZWxmLl9fc3VtIC8gc2VsZi5fX2NvdW50CgoKIiIiQ29kaWZpY2EgbGEgdXJsIGNvcnJpZ2llbmRvIGNhcmFjdGVyZXMgZXNwZWNpYWxlcyBxdWUgcHVlZGFuIHByZXNlbnRhcgpBcmc6CiAgICB1cmwtPiB1cmwgc2luIGNvZGlmaWNhY2lvbiBxdWUgc2UgZGVzZWEgY29ycmVnaXIKUmV0dXJuOgogICAgICAgIHVybCBjb2RpZmljYWRhIGNvbiBlc3RhbmRhcmVzIHdlYiByZXF1ZXN0CgoiIiIKCgpkZWYgVXJsRW5jb2RlZChzZWxmLCB1cmw6IHN0cikgLT4gc3RyOgogICAgdXJsID0gdXJsLnJlcGxhY2UoIiUiLCAiJTI1IikKICAgIHVybCA9IHVybC5yZXBsYWNlKCIjIiwgIiUyMyIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiICIsICIlMjAiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIiciLCAiJTI3IikKICAgIHVybCA9IHVybC5yZXBsYWNlKCciJywgIiUyMiIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiPCIsICIlM0MiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIj4iLCAiJTNFIikKICAgIHVybCA9IHVybC5yZXBsYWNlKCJ8IiwgIiU3QyIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiISIsICIlMjEiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIiQiLCAiJTI0IikKICAgIHVybCA9IHVybC5yZXBsYWNlKCImIiwgIiUyNiIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiKCIsICIlMjgiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIikiLCAiJTI5IikKICAgIHVybCA9IHVybC5yZXBsYWNlKCIqIiwgIiUyQSIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiKyIsICIlMkIiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIiwiLCAiJTJDIikKICAgIHVybCA9IHVybC5yZXBsYWNlKCIvIiwgIiUyRiIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiOiIsICIlM0EiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIjsiLCAiJTNCIikKICAgIHVybCA9IHVybC5yZXBsYWNlKCI9IiwgIiUzRCIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiPyIsICIlM0YiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIkAiLCAiJTQwIikKICAgIHVybCA9IHVybC5yZXBsYWNlKCJbIiwgIiU1QiIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiXSIsICIlNUQiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIlxuIiwgIiUwQSIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiLSIsICIlMkQiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIl8iLCAiJTVGIikKICAgIHVybCA9IHVybC5yZXBsYWNlKCJgIiwgIiU2MCIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiXiIsICIlNUUiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoInsiLCAiJTdCIikKICAgIHVybCA9IHVybC5yZXBsYWNlKCJ7IiwgIiU3RCIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgifiIsICIlN0UiKQoKICAgIHJldHVybiB1cmwKCgoiIiIKQ29udmllcnRlIHVuIG9iamV0byBhIGZvcm1hdG8gSlNPTgoKQXJnczoKICAgIG9iaiAoIE9iamV0byApOiBvYmpldG8gIGEgY29udmVydGlyIGVuIHN0cmluZyBqc29uClJldHVybjoKICAgIGpzb24gKFN0cmluZyk6IFNpIHB1ZG8gY29udmVydGlyIGEganNvbiwgc2lubyBkZXZ1ZWx2ZSAnTm9uZScKIiIiCgoKZGVmIENvbnZlcnRKc29uKG9iajogb2JqZWN0KSAtPiBzdHI6CiAgICB0cnk6CiAgICAgICAganNvbiA9IGpzb24uZHVtcHMob2JqLl9fZGljdF9fKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHJldHVybiBOb25lCgogICAgcmV0dXJuIGpzb24KCgoiIiIKRGVjb2RpZmljYSB1biBzdHJpbmcgZW4gIGZvcm1hdG8gSlNPTiB5IGFjdHVhbGl6YSBlbCB0aXBvIGRlIG9iamV0byB5YSBjcmVhZG8KCkFyZ3M6CiAgICBqc29uRGF0YSAoU3RyaW5nKTogU3RyaW5nIGVuIGZvcm1hdG8gSlNPTgogICAgb2JqIChPYmpldG8pOiBvYmpldG8gcXVlIGNvbnRpZW5lIHRvZG9zIMODwrMgcGFyY2lhbG1lbnRlICBsb3MgcGFyYW1ldHJvcyBxdWUgc2UgIGRlY29kaWZpY2FyYW4gZW4gImpzb25EYXRhIiBkb25kZSBzZSBhY3R1YWxpemFyYSBzdXMgdmFsb3JlcwpSZXR1cm46CiAgICBCb29sOiAnVHJ1ZScgc2kgbG9ncm8gZGVjb2RpZmljYXIgZWwganNvbiAsICdGYWxzZScgc2kgcHJvZHVqbyB1bmEgZXhlcGNpb24gcG9yIGZvcm1hdG8gaW5jb3JyZWN0bwoiIiIKCgpkZWYgRGVjb2RlSnNvblRvT2JqKGpzb25EYXRhOiBzdHIsIG9iajogb2JqZWN0KSAtPiBib29sOgogICAgdHJ5OgogICAgICAgIGRhdGFEaWN0ID0ganNvbi5sb2Fkcyhqc29uRGF0YSkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBmb3Iga2V5IGluIGRhdGFEaWN0OgogICAgICAgIHRyeTogICMgU2kgZWwgcGFyYW1ldHJvIHEgdmllbmUgZW4gZWwganNvbiBubyBjb2luY2lkZSBjb24gbmluZ3VuIHBhcmFtZXRybyBkZSBkZSAnb2JqJyAgbGFuemFyw4PCoSB1bmEgZXhlcGNpb24geSBzaW1wbGVtZW50ZSBzZSBzYWx0YXJhIGxhIGFjdHVhbGl6YWNpb24gaW5uZWNlc2FyaWEKICAgICAgICAgICAgaWYgaGFzYXR0cihvYmosIGtleSk6CiAgICAgICAgICAgICAgICBzZXRhdHRyKG9iaiwga2V5LCBkYXRhRGljdFtrZXldKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoIk5vIGVuY29udHJhZG8gYXRyaWJ1dG8gZW4gZGljdCIpCiAgICAgICAgICAgIHBhc3MKCiAgICByZXR1cm4gVHJ1ZQoKCmRlZiBDb3B5T2JqKG9ialNyYzogb2JqZWN0LCBvYmpEZXN0OiBvYmplY3QpIC0+IGJvb2w6CiAgICB0cnk6CiAgICAgICAgZGF0YURpY3QgPSBvYmpTcmMuX19kaWN0X18KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBmb3Iga2V5IGluIGRhdGFEaWN0OgogICAgICAgIHRyeTogICMgU2kgZWwgcGFyYW1ldHJvIHEgdmllbmUgZW4gZWwganNvbiBubyBjb2luY2lkZSBjb24gbmluZ3VuIHBhcmFtZXRybyBkZSBkZSAnb2JqJyAgbGFuemFyw4PCoSB1bmEgZXhlcGNpb24geSBzaW1wbGVtZW50ZSBzZSBzYWx0YXJhIGxhIGFjdHVhbGl6YWNpb24gaW5uZWNlc2FyaWEKICAgICAgICAgICAgaWYgaGFzYXR0cihvYmpEZXN0LCBrZXkpOgogICAgICAgICAgICAgICAgc2V0YXR0cihvYmpEZXN0LCBrZXksIGRhdGFEaWN0W2tleV0pCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludCgiTm8gZW5jb250cmFkbyBhdHJpYnV0byBlbiBkaWN0IikKICAgICAgICAgICAgcGFzcwoKICAgIHJldHVybiBUcnVlCgoKdGltZVJlYyA9IGxpc3QoKQoKCmNsYXNzIExvZ0l0ZW06CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi5uYW1lID0gIiIKICAgICAgICBzZWxmLnRpbWVQYXNzID0gIiIKCgoiIiJTZXBhcmEgdGllbXBvcyBlbnRyZSBtdWVzdHJvcyBzaW4gYmxvcXVlbwphcmdzOiAgIG5hbWUtPiBub21icmUgZGUgbGEgaW5zdGFuY2lhIHF1ZSBzZSB1dGlsaXphcmEsIGRvbmRlIHNlIGxsYW1lIGEgZXN0YSBmdW5jaW9uIGNvbiBlbCBtaXNtbyBub21icmUgYXBsaWNhcmEgbGEgc2VwYXJhY2lvbiBkZSB0aWVtbwogICAgICAgIHRpbWVTZWMtPiB0aWVtcG8gZW4gc2VndW5kbyBxdWUgc2UgcmVxdWllcmUgcGFyYSBsYSBzZXBhcmFjaW9uLCBubyBoYXkgYmxvcXVlb3MgcG9ycXVlIHVzYSBwYXJhIHNlcGFyYXIgOiB1dGltZS50aWNrc19tcygpCgoiIiIKCgpkZWYgSXNUaW1lUHJvY2VzcyhuYW1lLCB0aW1lU2VjKToKICAgIGdsb2JhbCB0aW1lUmVjCgogICAgaWR4ID0gLTEKCiAgICBjb3VudCA9IDAKCiAgICBpZiBsZW4odGltZVJlYykgPiAwOgogICAgICAgIGZvciBpdGVtIGluIHRpbWVSZWM6CiAgICAgICAgICAgIGlmIG5hbWUgPT0gaXRlbS5uYW1lOgogICAgICAgICAgICAgICAgaWR4ID0gY291bnQKCiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgY291bnQgKz0gMQoKICAgIGlmIGlkeCA9PSAtMToKICAgICAgICB0aW1lUmVjLmFwcGVuZChMb2dJdGVtKCkpCgogICAgICAgIHRpbWVSZWNbLTFdLm5hbWUgPSBuYW1lCiAgICAgICAgdGltZVJlY1stMV0udGltZVBhc3MgPSB1dGltZS50aWNrc19tcygpCgogICAgICAgIHJldHVybiBUcnVlCgogICAgZWxzZToKICAgICAgICBmYWx0YSA9IHV0aW1lLnRpY2tzX21zKCkgLSB0aW1lUmVjW2lkeF0udGltZVBhc3MKCiAgICAgICAgaWYgZmFsdGEgPiB0aW1lU2VjOgogICAgICAgICAgICB0aW1lUmVjW2lkeF0udGltZVBhc3MgPSB1dGltZS50aWNrc19tcygpCgogICAgICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIHJldHVybiBGYWxzZQoKCml0ZW1SZWMgPSBsaXN0KCkKCgpjbGFzcyBSZWNJdGVtczoKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBzZWxmLm5hbWUgPSAiIgogICAgICAgIHNlbGYuaXRlbSA9ICIiCgoKIiIiVmVyaWZpY2Egc2kgZWwgdmFsb3IgcGFzYWRvIHBvciBhcmd1bWVudG8gZXMgZGlmZXJlbnRlIGEgbGEgZGVsIGFudGVyaW9yIG11ZXN0cmVvLCBkZSBzZXIgYXNpIHJldG9ybmEgdHJ1ZSB5IGVzcGVyYSB1biB0aWVtcG8gdGltZVNlYyAoc2luIGJsb3F1ZW8pIHBhcmEgdm9sdmVyIGEgdmVyaWZpY2FyIGNhbWJpb3MKQXJnczoKICAgIG5hbWUtPiAgbm9tYnJlIGFzaWduYWRvIGEgZXN0ZSBhbCBpdGVtIGVuIGN1ZXN0aW9uLCBwdWVkZSBzZXIgY3VhbHF1aWVyYSwgcGVybyBjdWFuZG8gc2UgdHJhdGUgZGUgbG8gbWlzbW8gdGllbmUgcXVlIHNlciBpZ3VhbCBlbiBjYWRhIGxsYW1hZGEsIHBhcmEgcXVlIHRvbWUgZW4KICAgICAgICAgICAgY3VlbnRhIGVsIHZhbG9yIHkgdGllbXBvCiAgICBpdGVtVmFsdWUtPiBpdGVtIHF1ZSBzZSBxdWllcmUgdGVzdGVhcgogICAgdGltZVNlYy0+IHRpZW1wbyBlbiBtaWxpc2VndW5kbyBtaW5pbW8gZGUgZXNwYWNpbyBlbnRyZSBzYWxpZGFzIFRydWUgcGFyYSBwcm9jZXNhciBzaSBlcyBxdWUgcHJvY2VkZTogbm8gYmxvcXVlYSBwb3JxdWUgdXNhIDogdXRpbWUudGlja3NfbXMoKQoiIiIKCgpkZWYgSXNUaW1lVG9Mb2cobmFtZTogc3RyLCBpdGVtVmFsdWUsIHRpbWVTZWM6IGludCk6CiAgICBpZHggPSAtMQoKICAgIGNvdW50ID0gMAoKICAgIGlmIGxlbihpdGVtUmVjKSA+IDA6CiAgICAgICAgZm9yIGl0ZW0gaW4gaXRlbVJlYzoKICAgICAgICAgICAgaWYgbmFtZSA9PSBpdGVtLm5hbWU6CiAgICAgICAgICAgICAgICBpZHggPSBjb3VudAoKICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICBjb3VudCArPSAxCgogICAgaWYgaWR4ID09IC0xOgogICAgICAgIGl0ZW1SZWMuYXBwZW5kKFJlY0l0ZW1zKCkpCgogICAgICAgIGl0ZW1SZWNbLTFdLm5hbWUgPSBuYW1lCiAgICAgICAgaXRlbVJlY1stMV0uaXRlbSA9IGl0ZW1WYWx1ZQoKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGVsc2U6CiAgICAgICAgaWYgaXRlbVJlY1tpZHhdLml0ZW0gIT0gaXRlbVZhbHVlOgogICAgICAgICAgICBpZiBJc1RpbWVQcm9jZXNzKG5hbWUsIHRpbWVTZWMpOgogICAgICAgICAgICAgICAgaXRlbVJlY1tpZHhdLml0ZW0gPSBpdGVtVmFsdWUKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCgogICAgcmV0dXJuIEZhbHNlCgoKZGVmIFNwbGl0U3RyaW5nKGRhdGE6IHN0ciwgcG9zOiBpbnQsIHNlcF9pbml0OiBzdHIsIHNlcF9lbmQ6IHN0ciA9IE5vbmUpOgoKICAgIGNvdW50ID0gMAoKICAgIGkgPSAwCgogICAgd2hpbGUgY291bnQgPCBwb3M6CgogICAgICAgIGkgPSBkYXRhLmZpbmQoc2VwX2luaXQsIGkgKyAxKQoKICAgICAgICBpZiBpID49IDA6CgogICAgICAgICAgICBjb3VudCArPSAxCgogICAgICAgICAgICBpZiBjb3VudCA9PSBwb3M6CiAgICAgICAgICAgICAgICBpZiBzZXBfZW5kICE9IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgZSA9IGRhdGEuZmluZChzZXBfZW5kLCBpICsgMSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZSA9IGRhdGEuZmluZChzZXBfaW5pdCwgaSArIDEpCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRhdCA9IGRhdGFbaSArIDE6IGVdCgogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXQKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwcmludCgiZmFpbCIpCiAgICAgICAgICAgICAgICAgICAgcGFzcwoKICAgIHJldHVybiAibm9uZSIKCgpkZWYgZGVjaW1hbF9kZWdyZWVzKGRlZ3JlZXMsIG1pbnV0ZXMpOgogICAgcmV0dXJuIGRlZ3JlZXMgKyBtaW51dGVzLzYwCgoKZGVmIEdldERlY2ltYWxEZWdGcm9tR3BzRm9ybWF0KGRhdGE6IHN0ciwgaGVtOiBzdHIpOgoKICAgIGkgPSBkYXRhLmZpbmQoJy4nKQoKICAgIGRlZyA9IDAKICAgIG1pbiA9IDAKCiAgICBpZiBpID4gMDoKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBkZWcgPSBpbnQoZGF0YVswOmktMl0pCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgdHJ5OgogICAgICAgICAgICBtaW4gPSBmbG9hdChkYXRhW2ktMjpdKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKICAgICAgICB2YWwgPSBkZWNpbWFsX2RlZ3JlZXMoZGVnLCBtaW4pCgogICAgICAgIGlmIGhlbSA9PSAnUycgb3IgaGVtID09ICdXJzoKICAgICAgICAgICAgdmFsICo9IC0xCgogICAgICAgIHJldHVybiB2YWwKCiAgICByZXR1cm4gMAoKCmNsYXNzIFN0YXRlTGVkczoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBwaW4sIHN0YXRlX2xlZF9sb3c9MCwgc3RhdGVfbGVkX2hpZ2g9MCwgc2FtcGxlZF9tcz0xKToKICAgICAgICBzZWxmLnBpbiA9IFBpbihwaW4sIFBpbi5PVVQpCiAgICAgICAgc2VsZi5fX3N0YXRlX2xlZF9sb3cgPSBzdGF0ZV9sZWRfbG93CiAgICAgICAgc2VsZi5fX3N0YXRlX2xlZF9oaWdoID0gc3RhdGVfbGVkX2hpZ2gKICAgICAgICBzZWxmLnNhbXBsZWRfbXMgPSBzYW1wbGVkX21zCiAgICAgICAgc2VsZi5zdGF0ZV9sZWQgPSBGYWxzZQogICAgICAgIHNlbGYuY291bnRfc3RhdGVfbGVkID0gMAoKICAgIGRlZiBTZXRTdGF0ZXMoc2VsZiwgc3RhdGVfbGVkX2xvdywgc3RhdGVfbGVkX2hpZ2gpOgogICAgICAgIHNlbGYuc3RhdGVfbGVkX2xvdyA9IHN0YXRlX2xlZF9sb3cKICAgICAgICBzZWxmLnN0YXRlX2xlZF9oaWdoID0gc3RhdGVfbGVkX2hpZ2gKCiAgICBAcHJvcGVydHkKICAgIGRlZiBzdGF0ZV9sZWRfbG93KHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9fc3RhdGVfbGVkX2xvdwoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHN0YXRlX2xlZF9oaWdoKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9fc3RhdGVfbGVkX2hpZ2gKCiAgICBkZWYgU3RhdGVMZWQoc2VsZiwgc3RhdGVfbGVkX2xvdz0tMSwgc3RhdGVfbGVkX2hpZ2g9LTEpOgogICAgICAgIGlmIHN0YXRlX2xlZF9sb3cgPj0gMCBhbmQgc3RhdGVfbGVkX2hpZ2ggPj0gMDoKICAgICAgICAgICAgc2VsZi5fX3N0YXRlX2xlZF9sb3cgPSBzdGF0ZV9sZWRfbG93CiAgICAgICAgICAgIHNlbGYuX19zdGF0ZV9sZWRfaGlnaCA9IHN0YXRlX2xlZF9oaWdoCgogICAgICAgIGlmIHNlbGYuX19zdGF0ZV9sZWRfbG93ID4gMCBhbmQgc2VsZi5fX3N0YXRlX2xlZF9oaWdoID4gMDoKICAgICAgICAgICAgaWYgc2VsZi5zdGF0ZV9sZWQ6CiAgICAgICAgICAgICAgICBpZiBzZWxmLmNvdW50X3N0YXRlX2xlZCA+PSAoc2VsZi5fX3N0YXRlX2xlZF9oaWdoIC8gc2VsZi5zYW1wbGVkX21zKToKICAgICAgICAgICAgICAgICAgICBzZWxmLnBpbi5vZmYoKQoKICAgICAgICAgICAgICAgICAgICBzZWxmLnN0YXRlX2xlZCA9IEZhbHNlCgogICAgICAgICAgICAgICAgICAgIHNlbGYuY291bnRfc3RhdGVfbGVkID0gMAoKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIHNlbGYuY291bnRfc3RhdGVfbGVkID49IHNlbGYuX19zdGF0ZV9sZWRfbG93IC8gc2VsZi5zYW1wbGVkX21zOgogICAgICAgICAgICAgICAgICAgIHNlbGYucGluLm9uKCkKCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zdGF0ZV9sZWQgPSBUcnVlCgogICAgICAgICAgICAgICAgICAgIHNlbGYuY291bnRfc3RhdGVfbGVkID0gMAoKICAgICAgICAgICAgc2VsZi5jb3VudF9zdGF0ZV9sZWQgKz0gMQoKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBzZWxmLl9fc3RhdGVfbGVkX2hpZ2ggPiAwOgogICAgICAgICAgICAgICAgc2VsZi5waW4ub24oKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5waW4ub2ZmKCkKCgojIHJlZ2lvbiBzYW1wbGVzCiMgZnJvbSBzcmMubGlicyBpbXBvcnQgVXRpbAoKIyBjbGFzcyB0ZXN0OgojICAgICBkZWYgX19pbml0X18oc2VsZik6CiMgICAgICAgICBzZWxmLmRhdGEgPSAxMjMuNDU2Nzg5MTIzCiMgICAgICAgICBzZWxmLnBwID0gIkVzdG8gZXMgcHJ1ZWJhIgojICAgICAgICAgc2VsZi53dyA9IHsidmFsMSI6ICJhc2QiLCAidmFsMiI6IDEyM30KIyAgICAgICAgIHNlbGYucHJ1ZWJhID0gWzEsIDIuOSwgNC41LCA2LjcsIDQ1LjEsIDZdCiMgICAgICAgICBzZWxmLnR1cCA9IFs0NSwgInBlcGUiXQoKCiMgb2JqMSA9IHRlc3QoKQoKIyBzdHJkYXRhID0gVXRpbC5Db252ZXJ0SnNvbihvYmoxKQoKIyBwcmludChzdHJkYXRhKQoKIyBvYmoyID0gdGVzdCgpCgojIFV0aWwuRGVjb2RlSnNvblRvT2JqKHN0cmRhdGEsIG9iajIpCgojIHByaW50KG9iajIuZGF0YSkKCiMgcHJpbnQob2JqMi5fX2RpY3RfXykKCiMgZW5kcmVnaW9uCg=="}]}