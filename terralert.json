{"version": "1.0", "files": [{"patch": "main.py", "content": "ZnJvbSBtYWNoaW5lIGltcG9ydCBQaW4sIHVuaXF1ZV9pZCwgVUFSVAppbXBvcnQgdGltZQppbXBvcnQgdWFzeW5jaW8KZnJvbSBzcmMubGlicy5TaW03NjAwRHJpdmVyIGltcG9ydCBTaW03NjAwRGlydmVyCmZyb20gc3JjLmxpYnMuT1RBX1Byb2dyYW1tZXIgaW1wb3J0IE90YVByb2dyYW1tZXIKCnRpbWUuc2xlZXAoMykKcHJpbnQoIkluaWNpbyBkZSBwcm9ncmFtYSBlbi4uLiIpCnRpbWUuc2xlZXAoMSkKCmVuZHBvaW50X3Byb2dyYW0gPSAiaHR0cHM6Ly9jZ3VlcnJhd2FyLmdpdGh1Yi5pby9hcGlfZG93bmxvYWQvdGVycmFsZXJ0Lmpzb24iCgojUGFyYSBxdWUgb3RhIGZ1bmNpb25lIHRhbnRvIGxhIHZlcnNpb24gZGUgZW46IE90YVByb2dyYW1tZXIoKSAtPmluaXQgY29tbyBsYSBkZSBlbCBnaXRodWIganNvbiBkZWJlbiBjb2luY2lkaXIgcGFyYSBxIG5vIHNlIGVzdGUgZXRlcm5hbWVudGUgcmVwcm9ncmFtYW5kbwpvdGEgPSBPdGFQcm9ncmFtbWVyKDAsIDExNTIwMCwgJzEuMCcsIGVuZHBvaW50X3Byb2dyYW0gKQoKbW9kZW03NjAwID0gU2ltNzYwMERpcnZlcigwLCAxMTUyMDApCgphc3luYyBkZWYgbWFpbigpOgoKICAgIHVhc3luY2lvLmNyZWF0ZV90YXNrKG90YS5UYXNrRm9ySXNOZWVkVG9Qcm9ncmFtKCkpICAjIEVzIHBvc2libGUgcXVlIHNlYSBtYW51YWwgbGEgdmVyaWZpY2FjaW9uIGRlIHZlcnNpb24sIGVuIHRhbCBjYXNvIGxsYW1hciBkaXJlY3RhbWVudGUgOiBhd2FpdCBUYXNrRm9ySXNOZWVkVG9Qcm9ncmFtKCkgY3VhbmRvIHNlIHJlcXVpZXJhCgogICAgd2hpbGUgIG90YS5Jc0dvb2RWZXJzaW9uKCkgPT0gRmFsc2U6CiAgICAgICAgcHJpbnQoJ0NvbWllbnpvIGEgY29ycmVyIG1pcyB0YXJlYXMgcHJpbmNpcGFsZXMgZGVzcHVlcyBxIHZlcmlmaXF1ZSBxdWUgbm8gbmVjZXNpdG8gcmVwcm9ncmFtYXIgbWkgdmVyc2lvbiBkZSBwcm9ncmFtYSAnKQogICAgICAgIAogICAgICAgIGF3YWl0IHVhc3luY2lvLnNsZWVwX21zKDUwMDApCiAgICAKICAgICN1YXN5bmNpby5jcmVhdGVfdGFzayhUYXNrX3h4eHh4eHh4KSB0YXJlYXMgIHByaW5jaXBhbGVzIHkgbG9vcCBhIGxhIGVzcGVyYQoKICAgIHdoaWxlIFRydWU6CiAgICAgIAogICAgICAgIHByaW50KCdNYWluIHByb2dyYW0uLi4uICcpCiAgICAgICAgIyBzdGF0dXNfY29kZSwgcmVzcG9uc2VfZGF0YSA9IGF3YWl0IG1vZGVtNzYwMC5odHRwX2dldChlbmRwb2ludF9wcm9ncmFtKQoKICAgICAgICAjIHByaW50KHN0YXR1c19jb2RlKQogICAgICAgICMgcHJpbnQocmVzcG9uc2VfZGF0YSkKICAgIAogICAgICAgIGF3YWl0IHVhc3luY2lvLnNsZWVwX21zKDUwMDApCgp1YXN5bmNpby5ydW4obWFpbigpKQoKCiMgZnJvbSBtYWNoaW5lIGltcG9ydCBQaW4sIHVuaXF1ZV9pZCwgVUFSVAojIHVhcnQgPSBVQVJUKDApICAjbW9kZW0KIyB1YXJ0LmluaXQoMTE1MjAwLCByeGJ1Zj0yMDI0LCB0aW1lb3V0PTEwMCwgdGltZW91dF9jaGFyPTUwKQojIHVhcnQud3JpdGUoIkFUK0hUVFBJTklUXHJcbiIpCiMgdWFydC53cml0ZSgiQVQrQ0dQQUREUlxyXG4iKQojIHVybD0gImh0dHA6Ly9teS1qc29uLXNlcnZlci50eXBpY29kZS5jb20vQ2d1ZXJyYVdhci9hcGlfZG93bmxvYWQvZGIiCiMgdXJsPSAiaHR0cDovL2FwaS53b3JsZGJhbmsub3JnL3YyL2VuL2luZGljYXRvci9OWS5HRFAuTUtUUC5DRD9kb3dubG9hZGZvcm1hdD1jc3YiCiMgdXJsPSAiaHR0cHM6Ly9jZ3VlcnJhd2FyLmdpdGh1Yi5pby9hcGlfZG93bmxvYWQvZGIuanNvbiIKIyBwYXJhbSA9IGYnPSJVUkwiLCJ7dXJsfSInCiMjIyMjIyBwcmludChmIlxyXG5FamVjdXRhciBDb21hbmRvIEFUK0hUVFBQQVJBe3BhcmFtfSIpCiMgdWFydC53cml0ZShmIkFUK0hUVFBQQVJBe3BhcmFtfVxyXG4iKQojIHVhcnQud3JpdGUoZiJBVCtIVFRQQUNUSU9OPTBcclxuIikKIyB1YXJ0LndyaXRlKCJBVCtIVFRQSEVBRFxyXG4iKQojIHVhcnQud3JpdGUoZiJBVCtIVFRQUkVBRD0wLDIwMjRcclxuIikKIyB1YXJ0LndyaXRlKCJBVCtIVFRQVEVSTVxyXG4iKQoKIyB1YXJ0LnJlYWQoKQ=="}, {"patch": "src/libs/Sim7600Driver.py", "content": "ZnJvbSBtYWNoaW5lIGltcG9ydCBVQVJULCBQaW4KaW1wb3J0IHRpbWUKaW1wb3J0IHVhc3luY2lvCmltcG9ydCB1anNvbgoKZnJvbSBzcmMubGlicy5UaW1lb3V0T2JqZWN0IGltcG9ydCBUaW1lb3V0T2JqZWN0CmZyb20gc3JjLmxpYnMuVXRpbCBpbXBvcnQgU3BsaXRTdHJpbmcsIEdldERlY2ltYWxEZWdGcm9tR3BzRm9ybWF0CiMgZnJvbSBkZWNpbWFsIGltcG9ydCBEZWNpbWFsCgpkZWJ1ZyA9IEZhbHNlCgoKY2xhc3MgU2ltNzYwMERpcnZlcjoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBzZXJpYWw6IGludCwgYmF1ZDogaW50KSAtPiBOb25lOgogICAgICAgIHNlbGYuX19zZXJpYWwgPSBVQVJUKHNlcmlhbCkKICAgICAgICAjIHNlbGYuX19zZXJpYWwgPSBVQVJUKDEsIGJhdWRyYXRlPTk2MDAsIHR4PVBpbih0eHBpbiksIHJ4PVBpbihyeHBpbikpCiAgICAgICAgc2VsZi5fX3NlcmlhbC5pbml0KGJhdWRyYXRlPWJhdWQsIHJ4YnVmPTEwMjQsIHRpbWVvdXQ9MTAsIHRpbWVvdXRfY2hhcj01KQogICAgICAgIHNlbGYudGltZV91dGMgPSAwCiAgICAgICAgc2VsZi5sYXQgPSAwCiAgICAgICAgc2VsZi5sb24gPSAwCiAgICAgICAgc2VsZi5hbHQgPSAwCiAgICAgICAgIyBzZWxmLl9fc2VyaWFsLmluaXQoYml0cz04LCBwYXJpdHk9Tm9uZSwgc3RvcD0yKQoKICAgIGFzeW5jIGRlZiByZXNldF9tb2R1bGUoc2VsZik6CiAgICAgICAgc2VsZi5fX3NlcmlhbC53cml0ZSgiQVQrQ1JFU0VUXHJcbiIpCiAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgaWYgZGVidWc6CiAgICAgICAgICAgIHByaW50KCJSZXNwdWVzdGEgZGVsIHJlc2V0OiAiKQogICAgICAgICAgICBwcmludChzZWxmLl9fc2VyaWFsLnJlYWQoKSkKCiAgICBhc3luYyBkZWYgc3RhcnRfZ3BzKHNlbGYpOgogICAgICAgIHNlbGYuX19zZXJpYWwud3JpdGUoIkFUK0NHUFM9MVxyXG4iKQogICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgIGlmIGRlYnVnOgogICAgICAgICAgICBwcmludCgiSW5pdCBHcHMiKQogICAgICAgICAgICBwcmludChzZWxmLl9fc2VyaWFsLnJlYWQoKSkKCiAgICAgICAgc2VsZi5fX3NlcmlhbC53cml0ZSgiQVQrQ0dQU0FVVE89MVxyXG4iKQoKICAgICAgICB0aW1lLnNsZWVwKDAuNSkKCiAgICAgICAgaWYgZGVidWc6CiAgICAgICAgICAgIHByaW50KHNlbGYuX19zZXJpYWwucmVhZCgpKQogICAgICAgICMgc2VsZi5fX3NlcmlhbC53cml0ZSgiQVQrQ0dQU05NRUE9MVxyXG4iKQoKICAgIGFzeW5jIGRlZiB1cGRhdGVfZ3BzKHNlbGYpOgogICAgICAgIHByaW50KCJVcGRhdGUgR3BzIikKICAgICAgICBzZWxmLl9fc2VyaWFsLndyaXRlKCJBVCtDR1BTSU5GT1xyXG4iKQogICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgIGRhdGEgPSBzZWxmLl9fc2VyaWFsLnJlYWQoKS5kZWNvZGUoInV0Zi04IikKICAgICAgICBpZiBkZWJ1ZzoKICAgICAgICAgICAgcHJpbnQoZGF0YSkKCiAgICAgICAgaWYgZGF0YS5maW5kKCJPS1xyXG4iKSA+IDA6CiAgICAgICAgICAgICMgQVQrQ0dQU0lORk9cclxyXG4rQ0dQU0lORk86IDM0MTAuMzExODU4LFMsMDcwNDQuMDU0MDc5LFcsMjgxMjIzLDE0MzQ0Mi4wLDUxNS44LDAuMCxcclxuXHJcbk9LXHJcbgoKICAgICAgICAgICAgbGF0ID0gU3BsaXRTdHJpbmcoZGF0YSwgMSwgIjoiLCAiLCIpWzE6XQoKICAgICAgICAgICAgaGVtX3YgPSBTcGxpdFN0cmluZyhkYXRhLCAxLCAiLCIpCgogICAgICAgICAgICBzZWxmLmxhdCA9IEdldERlY2ltYWxEZWdGcm9tR3BzRm9ybWF0KGxhdCwgaGVtX3YpCgogICAgICAgICAgICBpZiBkZWJ1ZzoKICAgICAgICAgICAgICAgIHByaW50KHNlbGYubGF0KQogICAgICAgICAgICAgICAgcHJpbnQoaGVtX3YpCgogICAgICAgICAgICBsb24gPSBTcGxpdFN0cmluZyhkYXRhLCAyLCAiLCIpCgogICAgICAgICAgICBoZW1faCA9IFNwbGl0U3RyaW5nKGRhdGEsIDMsICIsIikKCiAgICAgICAgICAgIHNlbGYubG9uID0gR2V0RGVjaW1hbERlZ0Zyb21HcHNGb3JtYXQobG9uLCBoZW1faCkKCiAgICAgICAgICAgIGlmIGRlYnVnOgogICAgICAgICAgICAgICAgcHJpbnQoc2VsZi5sb24pCiAgICAgICAgICAgICAgICBwcmludChoZW1faCkKCiAgICAgICAgICAgIHNlbGYuYWx0ID0gU3BsaXRTdHJpbmcoZGF0YSwgNiwgIiwiKQoKICAgICAgICAgICAgaWYgZGVidWc6CiAgICAgICAgICAgICAgICBwcmludChzZWxmLmFsdCkKCiAgICAgICAgICAgICMgc2VsZi5sYXQgPSBHZXREZWNpbWFsRGVnRnJvbUdwc0Zvcm1hdChzZWxmLmxhdCkKCiAgICAgICAgICAgICMgcHJpbnQoc2VsZi5sYXQpCiAgICAgICAgICAgICMgcHJpbnQoc2VsZi5sb24pCiAgICAgICAgICAgICMgcHJpbnQoc2VsZi5hbHQpCgogICAgIiIiVmVyaWZpY2Egc2kgbGEgc2ltIHRpZW5lIElQCiAgICAiIiIKCiAgICBhc3luYyBkZWYgaXNfdGhlcmVfc2ltX2lwKHNlbGYpOgogICAgICAgICMgVmVyaWZpY2FyIHNpIG5vIGhheSBJUAogICAgICAgIGlwX29rID0gYXdhaXQgc2VsZi5fc2VuZF9DR1BBRERSKCkKICAgICAgICBpZiBkZWJ1ZzoKICAgICAgICAgICAgcHJpbnQoZiJpcF9vazoge2lwX29rfSIpCiAgICAgICAgaWYgbm90IGlwX29rOgogICAgICAgICAgICBhd2FpdCBzZWxmLl9zZW5kX0hUVFBURVJNKCkKICAgICAgICAgICAgYXdhaXQgc2VsZi5fc2VuZF9IVFRQSU5JVCgpCiAgICAgICAgICAgICMgVm9sdmVyIGEgdmVyaWZpY2FyIHNpIG5vIGhheSBJUAogICAgICAgICAgICBpcF9vayA9IGF3YWl0IHNlbGYuX3NlbmRfQ0dQQUREUigpCiAgICAgICAgICAgIGlmIG5vdCBpcF9vazoKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQoKICAgICIiIkVqZWN1dGEgbGEgY29uc3VsdGEgR0VULgogICAgU2kgZWwgc2VydmljaW8gSFRUUCBubyBlc3TDg8KhIGluaWNpYWxpemFkbywgbG8gaW5pY2lhbGl6YS4KCiAgICBBcmdzOgogICAgICAgIHVybCAoc3RyKTogVVJMIGEgY29uc3VsdGFyLgoKICAgIFJldHVybnM6CiAgICAgICAgdHVwbGVbaW50LCBzdHJdOiAoc3RhdHVzX2NvZGUsIHJlc3BvbnNlX2RhdGEpCiAgICAgICAgLSBzdGF0dXNfY29kZTogQ8ODwrNkaWdvIGRlIHJlc3B1ZXN0YSBkZSBsYSBjb25zdWx0YS4gYDBgIFNpIGhhIG9jdXJyaWRvIGFsZ8ODwrpuIGVycm9yLgogICAgICAgIC0gcmVzcG9uc2VfZGF0YTogVGV4dG8gZGUgbGEgcmVzcHVlc3RhLiBgTk9fSVBgIFNpIGVsIHNlcnZpY2lvIG5vIHRpZW5lIHVuYSBJUCBjb3JyZWN0YS4KICAgICAgICBgRVJST1JgIFNpIGhhIG9jdXJyaWRvIGFsZ8ODwrpuIGVycm9yIGVuIGxhIGVqZWN1Y2nDg8KzbiBkZSBsYSBjb25zdWx0YS4KICAgICIiIgogICAgYXN5bmMgZGVmIGh0dHBfZ2V0KHNlbGYsIHVybDogc3RyLCAgbWF4X2RhdGFfdG9fcmVhZCA9IC0xKSAtPiB0dXBsZVtpbnQsIHN0cl06CgogICAgICAgIHJlc3BvbnNlX2RhdGEgPSBzdHIoKQoKICAgICAgICAjIFZlcmlmaWNhciBzaSBubyBoYXkgSVAKICAgICAgICBpcF9vayA9IGF3YWl0IHNlbGYuX3NlbmRfQ0dQQUREUigpCiAgICAgICAgaWYgbm90IGlwX29rOgogICAgICAgICAgICBhd2FpdCBzZWxmLl9zZW5kX0hUVFBURVJNKCkKICAgICAgICAgICAgYXdhaXQgc2VsZi5fc2VuZF9IVFRQSU5JVCgpCiAgICAgICAgICAgICMgVm9sdmVyIGEgdmVyaWZpY2FyIHNpIG5vIGhheSBJUAogICAgICAgICAgICBpcF9vayA9IGF3YWl0IHNlbGYuX3NlbmRfQ0dQQUREUigpCiAgICAgICAgICAgIGlmIG5vdCBpcF9vazoKICAgICAgICAgICAgICAgIHJldHVybiAwLCAiTk9fSVAiCgogICAgICAgIGF3YWl0IHNlbGYuX3NlbmRfSFRUUFBBUkEoZic9IlVSTCIsInt1cmx9IicpCiAgICAgICAgIyBBY3Rpb24gMCBlcyBlbCBtw4PCqXRvZG8gR0VUCiAgICAgICAgcmVzdWx0LCBzdGF0dXNfY29kZSwgZGF0YV9sZW4gPSBhd2FpdCBzZWxmLl9zZW5kX0hUVFBBQ1RJT04oIjAiKQogICAgICAgIGlmIHJlc3VsdCBhbmQgZGF0YV9sZW4gPiAwOgogICAgICAgICAgICAjIFJlYWQgMCBjb3JyZXNwb25kZSBhIGxhIGxlY3R1cmEgZGUgbGEgcmVzcHVlc3RhIGRlIGxhIGFjY2nDg8KzbiBHRVQKICAgICAgICAgICAgcmVzcG9uc2VfZGF0YSA9IGF3YWl0IHNlbGYuX3NlbmRfSFRUUFJFQUQoIjAiLCBkYXRhX2xlbiwgbWF4X2RhdGFfcmVhZCA9IG1heF9kYXRhX3RvX3JlYWQpCgogICAgICAgICAgICBpZiByZXNwb25zZV9kYXRhOgogICAgICAgICAgICAgICAgIyBFeHRyYWVyIGxhIGRhdGEgZGUgbGEgcmVzcHVlc3RhIGRlbCBjb21hbmRvLgogICAgICAgICAgICAgICAgbGluZXMgPSByZXNwb25zZV9kYXRhLnNwbGl0bGluZXMoKQoKICAgICAgICAgICAgICAgIGRlbCBsaW5lc1swOjVdCiAgICAgICAgICAgICAgICBkZWwgbGluZXNbLTFdCgogICAgICAgICAgICAgICAgcmVzcG9uc2VfZGF0YSA9ICIiLmpvaW4obGluZXMpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiAwLCAiRVJST1IiCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgc3RhdHVzX2NvZGUgPiAwIGFuZCBkYXRhX2xlbiA9PSAwOiAgIyAhISEhRXN0byBlcyBudWV2byBwb3IgY2hhcmxpZQogICAgICAgICAgICAgICAgcmV0dXJuIHN0YXR1c19jb2RlLCAiIgogICAgICAgICAgICByZXR1cm4gMCwgIkVSUk9SIgoKICAgICAgICByZXR1cm4gc3RhdHVzX2NvZGUsIHN0cihyZXNwb25zZV9kYXRhKQoKICAgIGFzeW5jIGRlZiBodHRwX3Bvc3Qoc2VsZiwgdXJsOiBzdHIsIGRhdGE6IGRpY3QpIC0+IHR1cGxlW2ludCwgc3RyXToKICAgICAgICAiIiJFamVjdXRhIGxhIGNvbnN1bHRhIFBPU1QuCgogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHVybCAoc3RyKTogVVJMIGRlbCBlbmRwb2ludC4KICAgICAgICAgICAgZGF0YSAoZGljdCk6IERpY2Npb25hcmlvIGNvbiBlbCBwYXlsb2FkIGRlbCBtw4PCqXRvZG8gUE9TVC4KCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgdHVwbGVbaW50LCBzdHJdOiAoc3RhdHVzX2NvZGUsIHJlc3BvbnNlX2RhdGEpCiAgICAgICAgICAgIC0gc3RhdHVzX2NvZGU6IEPDg8KzZGlnbyBkZSByZXNwdWVzdGEgZGUgbGEgY29uc3VsdGEuIGAwYCBTaSBoYSBvY3VycmlkbyBhbGfDg8K6biBlcnJvci4KICAgICAgICAgICAgLSByZXNwb25zZV9kYXRhOiBUZXh0byBkZSBsYSByZXNwdWVzdGEuIGBOT19JUGAgU2kgZWwgc2VydmljaW8gbm8gdGllbmUgdW5hIElQIGNvcnJlY3RhLgogICAgICAgICAgICBgRVJST1JgIFNpIGhhIG9jdXJyaWRvIGFsZ8ODwrpuIGVycm9yIGVuIGxhIGVqZWN1Y2nDg8KzbiBkZSBsYSBjb25zdWx0YS4KICAgICAgICAiIiIKICAgICAgICByZXNwb25zZV9kYXRhID0gc3RyKCkKCiAgICAgICAgIyBWZXJpZmljYXIgc2kgbm8gaGF5IElQCiAgICAgICAgaXBfb2sgPSBhd2FpdCBzZWxmLl9zZW5kX0NHUEFERFIoKQogICAgICAgIGlmIG5vdCBpcF9vazoKICAgICAgICAgICAgYXdhaXQgc2VsZi5fc2VuZF9IVFRQVEVSTSgpCiAgICAgICAgICAgIGF3YWl0IHNlbGYuX3NlbmRfSFRUUElOSVQoKQogICAgICAgICAgICAjIFZvbHZlciBhIHZlcmlmaWNhciBzaSBubyBoYXkgSVAKICAgICAgICAgICAgaXBfb2sgPSBhd2FpdCBzZWxmLl9zZW5kX0NHUEFERFIoKQogICAgICAgICAgICBpZiBub3QgaXBfb2s6CiAgICAgICAgICAgICAgICByZXR1cm4gMCwgIk5PX0lQIgoKICAgICAgICBhd2FpdCBzZWxmLl9zZW5kX0hUVFBQQVJBKGYnPSJVUkwiLCJ7dXJsfSInKQoKICAgICAgICAjIENhcmRhciBlbCBwYXlsb2FkIGRlIGxhIHJlcXVlc3QgYWwgbW9kZW0uCiAgICAgICAgYXdhaXQgc2VsZi5fc2VuZF9IVFRQREFUQShkYXRhKQoKICAgICAgICAjIEFjdGlvbiAxIGVzIGVsIG3Dg8KpdG9kbyBQT1NUCiAgICAgICAgcmVzdWx0LCBzdGF0dXNfY29kZSwgZGF0YV9sZW4gPSBhd2FpdCBzZWxmLl9zZW5kX0hUVFBBQ1RJT04oIjEiKQogICAgICAgIGlmIHJlc3VsdCBhbmQgZGF0YV9sZW4gPiAwOgogICAgICAgICAgICAjIFJlYWQgMSBjb3JyZXNwb25kZSBhIGxhIGxlY3R1cmEgZGUgbGEgcmVzcHVlc3RhIGRlIGxhIGFjY2nDg8KzbiBQT1NUCiAgICAgICAgICAgIHJlc3BvbnNlX2RhdGEgPSBhd2FpdCBzZWxmLl9zZW5kX0hUVFBSRUFEKCIxIikKICAgICAgICAgICAgaWYgcmVzcG9uc2VfZGF0YToKICAgICAgICAgICAgICAgICMgRXh0cmFlciBsYSBkYXRhIGRlIGxhIHJlc3B1ZXN0YSBkZWwgY29tYW5kby4KICAgICAgICAgICAgICAgIGxpbmVzID0gcmVzcG9uc2VfZGF0YS5zcGxpdGxpbmVzKCkKICAgICAgICAgICAgICAgIGRlbCBsaW5lc1swOjVdCiAgICAgICAgICAgICAgICBkZWwgbGluZXNbLTFdCgogICAgICAgICAgICAgICAgcmVzcG9uc2VfZGF0YSA9ICIiLmpvaW4obGluZXMpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXR1cm4gMCwgIkVSUk9SIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAwLCAiRVJST1IiCgogICAgICAgIHJldHVybiBzdGF0dXNfY29kZSwgc3RyKHJlc3BvbnNlX2RhdGEpCgogICAgYXN5bmMgZGVmIF9zZW5kX0hUVFBJTklUKHNlbGYsIHRpbWVfb3V0X21zOiBpbnQgPSA0MDAwKSAtPiBib29sOgogICAgICAgICIiIkluaWNpYWxpemFyIGVsIHNlcnZpY2lvIEhUVFAoUykuCgogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIHRpbWVfb3V0X21zIChpbnQsIG9wdGlvbmFsKTogVGltZW91dCBlbiBtcyBwYXJhIGxhIHJlc3B1ZXN0YSBkZWwgY29tYW5kby4gRGVmYXVsdHMgdG8gNDAwMC4KCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAgYm9vbDogYFRydWVgIHNpIGVsIGNvbWFuZG8gcmVzcG9uZGUgT0suIGBGYXNsZWAgc2kgZWwgY29tYW5kbyByZXNwb25kZSBFUlJPUi4KICAgICAgICAiIiIKICAgICAgICBpZiBkZWJ1ZzoKICAgICAgICAgICAgcHJpbnQoIlxyXG5FamVjdXRhciBDb21hbmRvIEFUK0hUVFBJTklUIikKICAgICAgICAjIFZhY2llciBlbCBidWZmZXIgZGUgbGVjdHVyYS4KICAgICAgICB3aGlsZSBzZWxmLl9fc2VyaWFsLnJlYWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcGFzcwogICAgICAgIGlmIGRlYnVnOgogICAgICAgICAgICBwcmludCgiUHVlcnRvIHNlcmllIGxpbXBpbyIpCiAgICAgICAgc2VsZi5fX3NlcmlhbC53cml0ZSgiQVQrSFRUUElOSVRcclxuIikKCiAgICAgICAgIyBDcmVhciB1biB0aW1lb3V0IHBhcmEgbGEgbGVjdHVyYSBkZSBsYSByZXNwdWVzdGEgZGVsIGNvbWFuZG8uCiAgICAgICAgdGltZW91dCA9IFRpbWVvdXRPYmplY3QodGltZV9vdXRfbXMpCiAgICAgICAgcmVhZGVkID0gYnl0ZXMoKQogICAgICAgIHJlc3VsdCA9IEZhbHNlCiAgICAgICAgd2hpbGUgbm90IHRpbWVvdXQuZXZhbCgpOgogICAgICAgICAgICByZXMgPSBzZWxmLl9fc2VyaWFsLnJlYWQoKQogICAgICAgICAgICBpZiByZXMgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICByZWFkZWQgKz0gcmVzCiAgICAgICAgICAgICAgICBpZiBiIk9LIiBpbiByZWFkZWQ6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbGlmIGIiRVJST1IiIGluIHJlYWRlZDoKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBGYWxzZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGF3YWl0IHVhc3luY2lvLnNsZWVwX21zKDIwKQogICAgICAgIGlmIGRlYnVnOgogICAgICAgICAgICBwcmludCgiUmVzcHVlc3RhIENvbWFuZG86IiwgcmVhZGVkLCAiXHJcbiIpCiAgICAgICAgcmV0dXJuIHJlc3VsdAoKICAgIGFzeW5jIGRlZiBfc2VuZF9IVFRQUEFSQShzZWxmLCBwYXJhbTogc3RyLCB0aW1lX291dF9tczogaW50ID0gNDAwMCkgLT4gYm9vbDoKICAgICAgICBpZiBkZWJ1ZzoKICAgICAgICAgICAgcHJpbnQoZiJcclxuRWplY3V0YXIgQ29tYW5kbyBBVCtIVFRQUEFSQXtwYXJhbX0iKQogICAgICAgICMgVmFjaWVyIGVsIGJ1ZmZlciBkZSBsZWN0dXJhLgogICAgICAgIHdoaWxlIHNlbGYuX19zZXJpYWwucmVhZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwYXNzCiAgICAgICAgaWYgZGVidWc6CiAgICAgICAgICAgIHByaW50KCJQdWVydG8gc2VyaWUgbGltcGlvIikKICAgICAgICBzZWxmLl9fc2VyaWFsLndyaXRlKGYiQVQrSFRUUFBBUkF7cGFyYW19XHJcbiIpCgogICAgICAgICMgQ3JlYXIgdW4gdGltZW91dCBwYXJhIGxhIGxlY3R1cmEgZGUgbGEgcmVzcHVlc3RhIGRlbCBjb21hbmRvLgogICAgICAgIHRpbWVvdXQgPSBUaW1lb3V0T2JqZWN0KHRpbWVfb3V0X21zKQogICAgICAgIHJlYWRlZCA9IGJ5dGVzKCkKICAgICAgICByZXN1bHQgPSBGYWxzZQogICAgICAgIHdoaWxlIG5vdCB0aW1lb3V0LmV2YWwoKToKICAgICAgICAgICAgcmVzID0gc2VsZi5fX3NlcmlhbC5yZWFkKCkKICAgICAgICAgICAgaWYgcmVzIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgcmVhZGVkICs9IHJlcwogICAgICAgICAgICAgICAgaWYgYiJPSyIgaW4gcmVhZGVkOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFRydWUKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZWxpZiBiIkVSUk9SIiBpbiByZWFkZWQ6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBhd2FpdCB1YXN5bmNpby5zbGVlcF9tcygyMCkKICAgICAgICBpZiBkZWJ1ZzoKICAgICAgICAgICAgcHJpbnQoIlJlc3B1ZXN0YSBDb21hbmRvOiIsIHJlYWRlZCwgIlxyXG4iKQogICAgICAgIHJldHVybiByZXN1bHQKCiAgICBhc3luYyBkZWYgX3NlbmRfSFRUUERBVEEoc2VsZiwgZGF0YTogZGljdCkgLT4gYm9vbDoKICAgICAgICBpZiBkZWJ1ZzoKICAgICAgICAgICAgcHJpbnQoZiJcclxuRWplY3V0YXIgQ29tYW5kbyBBVCtIVFRQREFUQSIpCiAgICAgICAgIyBWYWNpZXIgZWwgYnVmZmVyIGRlIGxlY3R1cmEuCiAgICAgICAgd2hpbGUgc2VsZi5fX3NlcmlhbC5yZWFkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBpZiBkZWJ1ZzoKICAgICAgICAgICAgcHJpbnQoIlB1ZXJ0byBzZXJpZSBsaW1waW8iKQoKICAgICAgICBqc29uX3N0ciA9IHVqc29uLmR1bXBzKGRhdGEpCiAgICAgICAgZGF0YV9sZW4gPSBsZW4oanNvbl9zdHIpCgogICAgICAgIHNlbGYuX19zZXJpYWwud3JpdGUoZiJBVCtIVFRQREFUQT17ZGF0YV9sZW59LDEwMDBcclxuIikKICAgICAgICBhd2FpdCB1YXN5bmNpby5zbGVlcF9tcygyMCkKICAgICAgICBzZWxmLl9fc2VyaWFsLnJlYWRsaW5lKCkgICMgRXN0YSBsw4PCrW5lYSBlcyBlbCBlY28sIHNlIGRlc2NhcnRhLgogICAgICAgIHJlcyA9IHNlbGYuX19zZXJpYWwucmVhZGxpbmUoKQogICAgICAgIGlmIHJlczoKICAgICAgICAgICAgaWYgZGVidWc6CiAgICAgICAgICAgICAgICBwcmludCgiUmVzcHVlc3RhIGRlbCBjb21hbmRvOiIsIHJlcykKICAgICAgICAgICAgaWYgYiJET1dOTE9BRCIgaW4gcmVzOgogICAgICAgICAgICAgICAgIyBFbnZpYXIgbGEgZGF0YSBhbCBNb2RlbS4KICAgICAgICAgICAgICAgIHNlbGYuX19zZXJpYWwud3JpdGUoanNvbl9zdHIpCiAgICAgICAgICAgICAgICBhd2FpdCB1YXN5bmNpby5zbGVlcF9tcygyMCkKICAgICAgICAgICAgICAgIHNlbGYuX19zZXJpYWwucmVhZGxpbmUoKSAgIyBFc3RhIGzDg8KtbmVhIGVzIGVsIGVjbywgc2UgZGVzY2FydGEuCiAgICAgICAgICAgICAgICByZXMgPSBzZWxmLl9fc2VyaWFsLnJlYWRsaW5lKCkKICAgICAgICAgICAgICAgIGlmIGRlYnVnOgogICAgICAgICAgICAgICAgICAgIHByaW50KCJSZWFkIFBheWxvYWQgU3RhdHVzOiIsIHJlcykKICAgICAgICAgICAgICAgIGlmIHJlcyBhbmQgYiJPSyIgaW4gcmVzOgogICAgICAgICAgICAgICAgICAgICMgRWwgbW9kZW0gYWNlcHTDg8KzIGxhIGRhdGEuCiAgICAgICAgICAgICAgICAgICAgaWYgZGVidWc6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJEYXRhIHBheWxvYWQgYWNlcHRhZGEgT0siKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgaWYgZGVidWc6CiAgICAgICAgICAgIHByaW50KCJFbCBNb2RlbSBubyBoYSByZXNwb25kaWRvLiAocmV0dXJuIEZhbHNlKSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgYXN5bmMgZGVmIF9zZW5kX0hUVFBBQ1RJT04oc2VsZiwgbWV0aG9kOiBzdHIsIHRpbWVfb3V0X21zOiBpbnQgPSA0MDAwKSAtPiB0dXBsZVtib29sLCBpbnQsIGludF06CiAgICAgICAgIiIiRWplY3V0YSBsYSBhY2Npw4PCs24gSFRUUChTKSAoR0VULCBQT1NULCBIRUFELCBERUxFVEUpLCB5IHJldG9ybmEgZWwgcmVzdWx0YWRvLCBzdGF0dXMgeSBkYXRhIGxlbi4KCiAgICAgICAgQXJnczoKICAgICAgICAgICAgbWV0aG9kIChzdHIpOiAiMSIgcGFyYSBHRVQuICIyIiBwYXJhIFBPU1QuICIzIiBwYXJhIEhFQUQuICI0IiBwYXJhIERFTEVURS4KICAgICAgICAgICAgdGltZV9vdXRfbXMgKGludCwgb3B0aW9uYWwpOiBUaW1lb3V0IGVuIG1zIHBhcmEgbGEgcmVzcHVlc3RhIGRlbCBjb21hbmRvLiBEZWZhdWx0cyB0byA0MDAwLgoKICAgICAgICBSZXR1cm5zOgogICAgICAgICAgICB0dXBsZVtib29sLCBpbnQsIGludF06IChyZXN1bHQsIHN0YXR1c19jb2RlLCBkYXRhX2xlbikKICAgICAgICAgICAgLSByZXN1bHQ6IGBUcnVlYCBzaSBsYSBhY2Npw4PCs24gc2UgcmVhbGl6w4PCsyBjb3JyZWN0YW1lbnRlLiBgRmFsc2VgIGVuIGNhc28gY29udHJhcmlvLgogICAgICAgICAgICAtIHN0YXR1c19jb2RlOiBDw4PCs2RpZ28gSFRUUCBkZSByZXNwdWVzdGEuCiAgICAgICAgICAgIC0gZGF0YV9sZW46IENhbnRpZGFkIGRlIGJ5dGVzIHF1ZSBzZSBwdWVkZW4gbGVlciBkZSBsYSByZXNwdWVzdGEuCiAgICAgICAgIiIiCiAgICAgICAgaWYgZGVidWc6CiAgICAgICAgICAgIHByaW50KGYiXHJcbkVqZWN1dGFyIENvbWFuZG8gQVQrSFRUUEFDVElPTj17bWV0aG9kfSIpCiAgICAgICAgIyBWYWNpZXIgZWwgYnVmZmVyIGRlIGxlY3R1cmEuCiAgICAgICAgd2hpbGUgc2VsZi5fX3NlcmlhbC5yZWFkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBpZiBkZWJ1ZzoKICAgICAgICAgICAgcHJpbnQoIlB1ZXJ0byBzZXJpZSBsaW1waW8iKQogICAgICAgIHNlbGYuX19zZXJpYWwud3JpdGUoZiJBVCtIVFRQQUNUSU9OPXttZXRob2R9XHJcbiIpCgogICAgICAgICMgQ3JlYXIgdW4gdGltZW91dCBwYXJhIGxhIGxlY3R1cmEgZGUgbGEgcmVzcHVlc3RhIGRlbCBjb21hbmRvLgogICAgICAgIHRpbWVvdXQgPSBUaW1lb3V0T2JqZWN0KHRpbWVfb3V0X21zKQogICAgICAgIHJlYWRlZCA9IGJ5dGVzKCkKICAgICAgICByZXN1bHQgPSBGYWxzZQogICAgICAgIHN0YXR1c19jb2RlID0gMAogICAgICAgIGRhdGFfbGVuID0gMAogICAgICAgIHdoaWxlIG5vdCB0aW1lb3V0LmV2YWwoKToKICAgICAgICAgICAgcmVzID0gc2VsZi5fX3NlcmlhbC5yZWFkKCkKICAgICAgICAgICAgaWYgcmVzIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgcmVhZGVkICs9IHJlcwogICAgICAgICAgICAgICAgaWYgYiIrSFRUUEFDVElPTjoiIGluIHJlYWRlZDoKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgIyBFeHRyYWVyIGVsIHN0YXR1c19jb2RlIHkgZWwgZGF0YV9sZW4uCiAgICAgICAgICAgICAgICAgICAgbGluZSA9IFtpdGVtIGZvciBpdGVtIGluIHJlYWRlZC5zcGxpdGxpbmVzKCkgaWYgYiIrSFRUUEFDVElPTjoiIGluIGl0ZW1dCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGxpbmUpID49IDE6CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzID0gbGluZVswXS5zcGxpdChiIiwiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oZWxlbWVudHMpID49IDM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNfY29kZSA9IGludChlbGVtZW50c1sxXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFfbGVuID0gaW50KGVsZW1lbnRzWzJdKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbGlmIGIiRVJST1IiIGluIHJlYWRlZDoKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBGYWxzZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGF3YWl0IHVhc3luY2lvLnNsZWVwX21zKDIwKQogICAgICAgIGlmIGRlYnVnOgogICAgICAgICAgICBwcmludCgiUmVzcHVlc3RhIENvbWFuZG86IiwgcmVhZGVkKQogICAgICAgIGlmIGRlYnVnOgogICAgICAgICAgICBwcmludCgiUmVzdWx0OiIsIHJlc3VsdCwgIiwgU3RhdHVzIENvZGU6Iiwgc3RhdHVzX2NvZGUsICIsIERhdGEgTGVuOiIsIGRhdGFfbGVuKQogICAgICAgIHJldHVybiByZXN1bHQsIHN0YXR1c19jb2RlLCBkYXRhX2xlbgoKICAgIGFzeW5jIGRlZiBfc2VuZF9IVFRQUkVBRChzZWxmLCBtZXRob2Q6IHN0ciwgZGF0YV9sZW4gPSAxMDI0LCAgbWF4X2RhdGFfcmVhZCA9IC0xLHRpbWVfb3V0X21zOiBpbnQgPSA0MDAwKSAtPiBzdHIgfCBOb25lOgogICAgICAgIGlmIGRlYnVnOgogICAgICAgICAgICBwcmludChmIlxyXG5FamVjdXRhciBDb21hbmRvIEFUK0hUVFBSRUFEPXttZXRob2R9LHtkYXRhX2xlbn0iKQogICAgICAgICMgVmFjaWVyIGVsIGJ1ZmZlciBkZSBsZWN0dXJhLgogICAgICAgIHdoaWxlIHNlbGYuX19zZXJpYWwucmVhZCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwYXNzCiAgICAgICAgaWYgZGVidWc6CiAgICAgICAgICAgIHByaW50KCJQdWVydG8gc2VyaWUgbGltcGlvIikKCiAgICAgICAgaWYgbWF4X2RhdGFfcmVhZCA+IDA6CiAgICAgICAgICAgIHNlbGYuX19zZXJpYWwud3JpdGUoZiJBVCtIVFRQUkVBRD17bWV0aG9kfSx7bWF4X2RhdGFfcmVhZH1cclxuIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLl9fc2VyaWFsLndyaXRlKGYiQVQrSFRUUFJFQUQ9e21ldGhvZH0se2RhdGFfbGVufVxyXG4iKQoKICAgICAgICAjIENyZWFyIHVuIHRpbWVvdXQgcGFyYSBsYSBsZWN0dXJhIGRlIGxhIHJlc3B1ZXN0YSBkZWwgY29tYW5kby4KICAgICAgICB0aW1lb3V0ID0gVGltZW91dE9iamVjdCh0aW1lX291dF9tcykKICAgICAgICByZWFkZWQgPSBieXRlcygpCiAgICAgICAgcmVzdWx0ID0gRmFsc2UKICAgICAgICB3aGlsZSBub3QgdGltZW91dC5ldmFsKCk6CiAgICAgICAgICAgIHJlcyA9IHNlbGYuX19zZXJpYWwucmVhZCgpCiAgICAgICAgICAgIGlmIHJlcyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIHJlYWRlZCArPSByZXMKICAgICAgICAgICAgICAgICNwcmludChyZWFkZWQpCiAgICAgICAgICAgICAgICBpZiBiIitIVFRQUkVBRDogMCIgaW4gcmVhZGVkOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFRydWUKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZWxpZiBiIkVSUk9SIiBpbiByZWFkZWQ6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBhd2FpdCB1YXN5bmNpby5zbGVlcF9tcygyMCkKICAgICAgICBpZiBkZWJ1ZzoKICAgICAgICAgICAgcHJpbnQoIlJlc3B1ZXN0YSBDb21hbmRvOiIsIHJlYWRlZCwgIlxyXG4iKQoKICAgICAgICBuMSA9IDAKCiAgICAgICAgc2l6ZSA9IGxlbihyZWFkZWQpCgogICAgICAgIHdoaWxlIG4xID49IDA6IAogICAgICAgICAgICBuMSA9IHJlYWRlZC5maW5kKGInK0hUVFBSRUFEOiBEQVRBJykgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbjEgPj0gMDoKICAgICAgICAgICAgICAgIG4yID0gcmVhZGVkLmZpbmQoYidccicsIG4xKSAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVhZGVkID0gcmVhZGVkWzA6bjFdICsgcmVhZGVkW24yOnNpemVdCiAgICAgICAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlYWRlZC5kZWNvZGUoInV0Zi04IikgaWYgcmVzdWx0IGVsc2UgTm9uZQoKICAgIGFzeW5jIGRlZiBfc2VuZF9IVFRQVEVSTShzZWxmLCB0aW1lX291dF9tczogaW50ID0gNDAwMCkgLT4gYm9vbDoKICAgICAgICBpZiBkZWJ1ZzoKICAgICAgICAgICAgcHJpbnQoIlxyXG5FamVjdXRhciBDb21hbmRvIEFUK0hUVFBURVJNIikKICAgICAgICAjIFZhY2llciBlbCBidWZmZXIgZGUgbGVjdHVyYS4KICAgICAgICB3aGlsZSBzZWxmLl9fc2VyaWFsLnJlYWQoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgcGFzcwogICAgICAgIGlmIGRlYnVnOgogICAgICAgICAgICBwcmludCgiUHVlcnRvIHNlcmllIGxpbXBpbyIpCiAgICAgICAgc2VsZi5fX3NlcmlhbC53cml0ZSgiQVQrSFRUUFRFUk1cclxuIikKCiAgICAgICAgIyBDcmVhciB1biB0aW1lb3V0IHBhcmEgbGEgbGVjdHVyYSBkZSBsYSByZXNwdWVzdGEgZGVsIGNvbWFuZG8uCiAgICAgICAgdGltZW91dCA9IFRpbWVvdXRPYmplY3QodGltZV9vdXRfbXMpCiAgICAgICAgcmVhZGVkID0gYnl0ZXMoKQogICAgICAgIHJlc3VsdCA9IEZhbHNlCiAgICAgICAgd2hpbGUgbm90IHRpbWVvdXQuZXZhbCgpOgogICAgICAgICAgICByZXMgPSBzZWxmLl9fc2VyaWFsLnJlYWQoKQogICAgICAgICAgICBpZiByZXMgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICByZWFkZWQgKz0gcmVzCiAgICAgICAgICAgICAgICBpZiBiIk9LIiBpbiByZWFkZWQ6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbGlmIGIiRVJST1IiIGluIHJlYWRlZDoKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBGYWxzZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGF3YWl0IHVhc3luY2lvLnNsZWVwX21zKDIwKQogICAgICAgIGlmIGRlYnVnOgogICAgICAgICAgICBwcmludCgiUmVzcHVlc3RhIENvbWFuZG86IiwgcmVhZGVkLCAiXHJcbiIpCiAgICAgICAgYXdhaXQgdWFzeW5jaW8uc2xlZXBfbXMoMTAwMCkKICAgICAgICByZXR1cm4gcmVzdWx0CgogICAgYXN5bmMgZGVmIF9zZW5kX0NHUEFERFIoc2VsZiwgdGltZV9vdXRfbXM6IGludCA9IDQwMDApIC0+IGJvb2w6CiAgICAgICAgIiIiVmVyaWZpY2FyIHNpIGVsIE1vZGVtIHRpZW5lIHVuYSBkaXJlY2Npw4PCs24gSVAgdsODwqFsaWRhIGFzaWduYWRhLgoKICAgICAgICBBcmdzOgogICAgICAgICAgICB0aW1lX291dF9tcyAoaW50LCBvcHRpb25hbCk6IFRpbWVvdXQgZW4gbXMgcGFyYSBsYSByZXNwdWVzdGEgZGVsIGNvbWFuZG8uIERlZmF1bHRzIHRvIDQwMDAuCgogICAgICAgIFJldHVybnM6CiAgICAgICAgICAgIGJvb2w6IGBUcnVlYCBzaSBsYSBkaXJlY2Npb24gSVAgZXMgdsODwqFsaWRhIHkgZGlmZXJlbnRlIGRlIDAuMC4wLjAgLSBgRmFsc2VgIGVuIGNhc28gY29udHJhcmlvLgogICAgICAgICIiIgogICAgICAgIGlmIGRlYnVnOgogICAgICAgICAgICBwcmludCgiXHJcbkVqZWN1dGFyIENvbWFuZG8gQVQrQ0dQQUREUiIpCiAgICAgICAgIyBWYWNpZXIgZWwgYnVmZmVyIGRlIGxlY3R1cmEuCiAgICAgICAgd2hpbGUgc2VsZi5fX3NlcmlhbC5yZWFkKCkgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBpZiBkZWJ1ZzoKICAgICAgICAgICAgcHJpbnQoIlB1ZXJ0byBzZXJpZSBsaW1waW8iKQogICAgICAgIHNlbGYuX19zZXJpYWwud3JpdGUoIkFUK0NHUEFERFJcclxuIikKCiAgICAgICAgIyBFamVtcGxvIGRlIHJlc3B1ZXN0YSBkZSBlc3RlIGNvbWFuZG86ICdBVCtDR1BBRERSXHJcclxuK0NHUEFERFI6IDEsMC4wLjAuMFxyXG5cclxuT0tcclxuJwogICAgICAgICMgQ3JlYXIgdW4gdGltZW91dCBwYXJhIGxhIGxlY3R1cmEgZGUgbGEgcmVzcHVlc3RhIGRlbCBjb21hbmRvLgogICAgICAgIHRpbWVvdXQgPSBUaW1lb3V0T2JqZWN0KHRpbWVfb3V0X21zKQogICAgICAgIHJlYWRlZCA9IGJ5dGVzKCkKICAgICAgICByZXN1bHQgPSBGYWxzZQogICAgICAgIHdoaWxlIG5vdCB0aW1lb3V0LmV2YWwoKToKICAgICAgICAgICAgcmVzID0gc2VsZi5fX3NlcmlhbC5yZWFkKCkKICAgICAgICAgICAgaWYgcmVzIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgcmVhZGVkICs9IHJlcwogICAgICAgICAgICAgICAgaWYgYiIrQ0dQQUREUjoiIGluIHJlYWRlZDoKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsaWYgYiJFUlJPUiIgaW4gcmVhZGVkOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgYXdhaXQgdWFzeW5jaW8uc2xlZXBfbXMoMjApCiAgICAgICAgaWYgZGVidWc6CiAgICAgICAgICAgIHByaW50KCJSZXNwdWVzdGEgQ29tYW5kbzoiLCByZWFkZWQsICJcclxuIikKICAgICAgICBpZiByZXN1bHQ6CiAgICAgICAgICAgICMgVmVyaWRpY2FyIHNpIGV4aXN0ZSB1bmEgSVAgZGlmZXJlbnRlIGRlIDAuMC4wLjAKICAgICAgICAgICAgbGluZXMgPSByZWFkZWQuc3BsaXRsaW5lcygpCiAgICAgICAgICAgIGZvciBsaW5lIGluIGxpbmVzOgogICAgICAgICAgICAgICAgIyBCdXNjYXIgbGEgaXAgc29sbyBlbiBsYXMgbGluZWFzIGRlIHJlc3B1ZXN0YSBkZWwgY29tYW5kbywgbm8gZW4gb3RyYXMuCiAgICAgICAgICAgICAgICBpZiBiIitDR1BBRERSOiIgaW4gbGluZToKICAgICAgICAgICAgICAgICAgICBlbGVtZW50cyA9IGxpbmUuc3BsaXQoYiIsIikKICAgICAgICAgICAgICAgICAgICByZXMgPSBzZWxmLl9faXNfdmFsaWRfaXB2NChlbGVtZW50c1stMV0pCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBfX2lzX3ZhbGlkX2lwdjQoc2VsZiwgaXBfYnl0ZXM6IGJ5dGVzKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlwX3N0ciA9IGlwX2J5dGVzLmRlY29kZSgidXRmLTgiKQogICAgICAgIGV4Y2VwdCBVbmljb2RlRGVjb2RlRXJyb3I6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBpZiBpcF9zdHIgPT0gIjAuMC4wLjAiOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgb2N0ZXRzID0gaXBfc3RyLnNwbGl0KCIuIikKICAgICAgICBpZiBsZW4ob2N0ZXRzKSAhPSA0OgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgZm9yIG9jdGV0IGluIG9jdGV0czoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbnVtID0gaW50KG9jdGV0KQogICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAgICAgaWYgbnVtIDwgMCBvciBudW0gPiAyNTU6CiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgcmV0dXJuIFRydWUK"}, {"patch": "src/libs/TimeoutObject.py", "content": "aW1wb3J0IHV0aW1lCgoKY2xhc3MgVGltZW91dE9iamVjdDoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB0aW1lb3V0X21zOiBpbnQpOgogICAgICAgIHNlbGYuX19zdGFydF90aW1lID0gdXRpbWUudGlja3NfbXMoKQogICAgICAgIHNlbGYuX190aW1lb3V0X21zID0gdGltZW91dF9tcwoKICAgIGRlZiBldmFsKHNlbGYpIC0+IGJvb2w6CiAgICAgICAgY3VycmVudF90aW1lID0gdXRpbWUudGlja3NfbXMoKQogICAgICAgIGVsYXBzZWRfdGltZSA9IHV0aW1lLnRpY2tzX2RpZmYoY3VycmVudF90aW1lLCBzZWxmLl9fc3RhcnRfdGltZSkKCiAgICAgICAgaWYgZWxhcHNlZF90aW1lID49IHNlbGYuX190aW1lb3V0X21zOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQo="}, {"patch": "src/libs/Util.py", "content": "aW1wb3J0IGpzb24KZnJvbSBtYWNoaW5lIGltcG9ydCBQaW4KaW1wb3J0IHV0aW1lCgoKY2xhc3MgQ2lyY3VsYXJCdWZmZXI6CiAgICBkZWYgX19pbml0X18oc2VsZiwgYnVmZmVyU2l6ZSk6CiAgICAgICAgc2VsZi5fX2J1ZmZlciA9IFswXSAqIGJ1ZmZlclNpemUKICAgICAgICBzZWxmLl9fc2l6ZTogaW50ID0gYnVmZmVyU2l6ZQogICAgICAgIHNlbGYuX19pbmRleDogaW50ID0gMAogICAgICAgIHNlbGYuX19jb3VudDogaW50ID0gMAogICAgICAgIHNlbGYuX19zdW06IGZsb2F0ID0gMAoKICAgIGRlZiBHZXRTaXplKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9fc2l6ZQoKICAgIGRlZiBHZXRDb3VudEl0ZW1zKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9fY291bnQKCiAgICBkZWYgQWRkVmFsdWUoc2VsZiwgdmFsdWU6IGZsb2F0KSAtPiBOb25lOgogICAgICAgIGlmIHNlbGYuX19jb3VudCA8IHNlbGYuX19zaXplOgogICAgICAgICAgICBzZWxmLl9fY291bnQgKz0gMQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuX19zdW0gLT0gc2VsZi5fX2J1ZmZlcltzZWxmLl9faW5kZXhdCgogICAgICAgIHNlbGYuX19zdW0gKz0gdmFsdWUKICAgICAgICBzZWxmLl9fYnVmZmVyW3NlbGYuX19pbmRleF0gPSB2YWx1ZQogICAgICAgIHNlbGYuX19pbmRleCA9IChzZWxmLl9faW5kZXggKyAxKSAlIHNlbGYuX19zaXplCgogICAgZGVmIEdldEF2ZXJhZ2Uoc2VsZikgLT4gZmxvYXQ6CiAgICAgICAgaWYgc2VsZi5fX2NvdW50ID09IDA6CiAgICAgICAgICAgIHJldHVybiAwCgogICAgICAgIHJldHVybiBzZWxmLl9fc3VtIC8gc2VsZi5fX2NvdW50CgoKIiIiQ29kaWZpY2EgbGEgdXJsIGNvcnJpZ2llbmRvIGNhcmFjdGVyZXMgZXNwZWNpYWxlcyBxdWUgcHVlZGFuIHByZXNlbnRhcgpBcmc6CiAgICB1cmwtPiB1cmwgc2luIGNvZGlmaWNhY2lvbiBxdWUgc2UgZGVzZWEgY29ycmVnaXIKUmV0dXJuOgogICAgICAgIHVybCBjb2RpZmljYWRhIGNvbiBlc3RhbmRhcmVzIHdlYiByZXF1ZXN0CgoiIiIKCgpkZWYgVXJsRW5jb2RlZChzZWxmLCB1cmw6IHN0cikgLT4gc3RyOgogICAgdXJsID0gdXJsLnJlcGxhY2UoIiUiLCAiJTI1IikKICAgIHVybCA9IHVybC5yZXBsYWNlKCIjIiwgIiUyMyIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiICIsICIlMjAiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIiciLCAiJTI3IikKICAgIHVybCA9IHVybC5yZXBsYWNlKCciJywgIiUyMiIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiPCIsICIlM0MiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIj4iLCAiJTNFIikKICAgIHVybCA9IHVybC5yZXBsYWNlKCJ8IiwgIiU3QyIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiISIsICIlMjEiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIiQiLCAiJTI0IikKICAgIHVybCA9IHVybC5yZXBsYWNlKCImIiwgIiUyNiIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiKCIsICIlMjgiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIikiLCAiJTI5IikKICAgIHVybCA9IHVybC5yZXBsYWNlKCIqIiwgIiUyQSIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiKyIsICIlMkIiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIiwiLCAiJTJDIikKICAgIHVybCA9IHVybC5yZXBsYWNlKCIvIiwgIiUyRiIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiOiIsICIlM0EiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIjsiLCAiJTNCIikKICAgIHVybCA9IHVybC5yZXBsYWNlKCI9IiwgIiUzRCIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiPyIsICIlM0YiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIkAiLCAiJTQwIikKICAgIHVybCA9IHVybC5yZXBsYWNlKCJbIiwgIiU1QiIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiXSIsICIlNUQiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIlxuIiwgIiUwQSIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiLSIsICIlMkQiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoIl8iLCAiJTVGIikKICAgIHVybCA9IHVybC5yZXBsYWNlKCJgIiwgIiU2MCIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgiXiIsICIlNUUiKQogICAgdXJsID0gdXJsLnJlcGxhY2UoInsiLCAiJTdCIikKICAgIHVybCA9IHVybC5yZXBsYWNlKCJ7IiwgIiU3RCIpCiAgICB1cmwgPSB1cmwucmVwbGFjZSgifiIsICIlN0UiKQoKICAgIHJldHVybiB1cmwKCgoiIiIKQ29udmllcnRlIHVuIG9iamV0byBhIGZvcm1hdG8gSlNPTgoKQXJnczoKICAgIG9iaiAoIE9iamV0byApOiBvYmpldG8gIGEgY29udmVydGlyIGVuIHN0cmluZyBqc29uClJldHVybjoKICAgIGpzb24gKFN0cmluZyk6IFNpIHB1ZG8gY29udmVydGlyIGEganNvbiwgc2lubyBkZXZ1ZWx2ZSAnTm9uZScKIiIiCgoKZGVmIENvbnZlcnRKc29uKG9iajogb2JqZWN0KSAtPiBzdHI6CiAgICB0cnk6CiAgICAgICAganNvbiA9IGpzb24uZHVtcHMob2JqLl9fZGljdF9fKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHJldHVybiBOb25lCgogICAgcmV0dXJuIGpzb24KCgoiIiIKRGVjb2RpZmljYSB1biBzdHJpbmcgZW4gIGZvcm1hdG8gSlNPTiB5IGFjdHVhbGl6YSBlbCB0aXBvIGRlIG9iamV0byB5YSBjcmVhZG8KCkFyZ3M6CiAgICBqc29uRGF0YSAoU3RyaW5nKTogU3RyaW5nIGVuIGZvcm1hdG8gSlNPTgogICAgb2JqIChPYmpldG8pOiBvYmpldG8gcXVlIGNvbnRpZW5lIHRvZG9zIMODwrMgcGFyY2lhbG1lbnRlICBsb3MgcGFyYW1ldHJvcyBxdWUgc2UgIGRlY29kaWZpY2FyYW4gZW4gImpzb25EYXRhIiBkb25kZSBzZSBhY3R1YWxpemFyYSBzdXMgdmFsb3JlcwpSZXR1cm46CiAgICBCb29sOiAnVHJ1ZScgc2kgbG9ncm8gZGVjb2RpZmljYXIgZWwganNvbiAsICdGYWxzZScgc2kgcHJvZHVqbyB1bmEgZXhlcGNpb24gcG9yIGZvcm1hdG8gaW5jb3JyZWN0bwoiIiIKCgpkZWYgRGVjb2RlSnNvblRvT2JqKGpzb25EYXRhOiBzdHIsIG9iajogb2JqZWN0KSAtPiBib29sOgogICAgdHJ5OgogICAgICAgIGRhdGFEaWN0ID0ganNvbi5sb2Fkcyhqc29uRGF0YSkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBmb3Iga2V5IGluIGRhdGFEaWN0OgogICAgICAgIHRyeTogICMgU2kgZWwgcGFyYW1ldHJvIHEgdmllbmUgZW4gZWwganNvbiBubyBjb2luY2lkZSBjb24gbmluZ3VuIHBhcmFtZXRybyBkZSBkZSAnb2JqJyAgbGFuemFyw4PCoSB1bmEgZXhlcGNpb24geSBzaW1wbGVtZW50ZSBzZSBzYWx0YXJhIGxhIGFjdHVhbGl6YWNpb24gaW5uZWNlc2FyaWEKICAgICAgICAgICAgaWYgaGFzYXR0cihvYmosIGtleSk6CiAgICAgICAgICAgICAgICBzZXRhdHRyKG9iaiwga2V5LCBkYXRhRGljdFtrZXldKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoIk5vIGVuY29udHJhZG8gYXRyaWJ1dG8gZW4gZGljdCIpCiAgICAgICAgICAgIHBhc3MKCiAgICByZXR1cm4gVHJ1ZQoKCmRlZiBDb3B5T2JqKG9ialNyYzogb2JqZWN0LCBvYmpEZXN0OiBvYmplY3QpIC0+IGJvb2w6CiAgICB0cnk6CiAgICAgICAgZGF0YURpY3QgPSBvYmpTcmMuX19kaWN0X18KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBmb3Iga2V5IGluIGRhdGFEaWN0OgogICAgICAgIHRyeTogICMgU2kgZWwgcGFyYW1ldHJvIHEgdmllbmUgZW4gZWwganNvbiBubyBjb2luY2lkZSBjb24gbmluZ3VuIHBhcmFtZXRybyBkZSBkZSAnb2JqJyAgbGFuemFyw4PCoSB1bmEgZXhlcGNpb24geSBzaW1wbGVtZW50ZSBzZSBzYWx0YXJhIGxhIGFjdHVhbGl6YWNpb24gaW5uZWNlc2FyaWEKICAgICAgICAgICAgaWYgaGFzYXR0cihvYmpEZXN0LCBrZXkpOgogICAgICAgICAgICAgICAgc2V0YXR0cihvYmpEZXN0LCBrZXksIGRhdGFEaWN0W2tleV0pCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludCgiTm8gZW5jb250cmFkbyBhdHJpYnV0byBlbiBkaWN0IikKICAgICAgICAgICAgcGFzcwoKICAgIHJldHVybiBUcnVlCgoKdGltZVJlYyA9IGxpc3QoKQoKCmNsYXNzIExvZ0l0ZW06CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi5uYW1lID0gIiIKICAgICAgICBzZWxmLnRpbWVQYXNzID0gIiIKCgoiIiJTZXBhcmEgdGllbXBvcyBlbnRyZSBtdWVzdHJvcyBzaW4gYmxvcXVlbwphcmdzOiAgIG5hbWUtPiBub21icmUgZGUgbGEgaW5zdGFuY2lhIHF1ZSBzZSB1dGlsaXphcmEsIGRvbmRlIHNlIGxsYW1lIGEgZXN0YSBmdW5jaW9uIGNvbiBlbCBtaXNtbyBub21icmUgYXBsaWNhcmEgbGEgc2VwYXJhY2lvbiBkZSB0aWVtbwogICAgICAgIHRpbWVTZWMtPiB0aWVtcG8gZW4gc2VndW5kbyBxdWUgc2UgcmVxdWllcmUgcGFyYSBsYSBzZXBhcmFjaW9uLCBubyBoYXkgYmxvcXVlb3MgcG9ycXVlIHVzYSBwYXJhIHNlcGFyYXIgOiB1dGltZS50aWNrc19tcygpCgoiIiIKCgpkZWYgSXNUaW1lUHJvY2VzcyhuYW1lLCB0aW1lU2VjKToKICAgIGdsb2JhbCB0aW1lUmVjCgogICAgaWR4ID0gLTEKCiAgICBjb3VudCA9IDAKCiAgICBpZiBsZW4odGltZVJlYykgPiAwOgogICAgICAgIGZvciBpdGVtIGluIHRpbWVSZWM6CiAgICAgICAgICAgIGlmIG5hbWUgPT0gaXRlbS5uYW1lOgogICAgICAgICAgICAgICAgaWR4ID0gY291bnQKCiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgY291bnQgKz0gMQoKICAgIGlmIGlkeCA9PSAtMToKICAgICAgICB0aW1lUmVjLmFwcGVuZChMb2dJdGVtKCkpCgogICAgICAgIHRpbWVSZWNbLTFdLm5hbWUgPSBuYW1lCiAgICAgICAgdGltZVJlY1stMV0udGltZVBhc3MgPSB1dGltZS50aWNrc19tcygpCgogICAgICAgIHJldHVybiBUcnVlCgogICAgZWxzZToKICAgICAgICBmYWx0YSA9IHV0aW1lLnRpY2tzX21zKCkgLSB0aW1lUmVjW2lkeF0udGltZVBhc3MKCiAgICAgICAgaWYgZmFsdGEgPiB0aW1lU2VjOgogICAgICAgICAgICB0aW1lUmVjW2lkeF0udGltZVBhc3MgPSB1dGltZS50aWNrc19tcygpCgogICAgICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIHJldHVybiBGYWxzZQoKCml0ZW1SZWMgPSBsaXN0KCkKCgpjbGFzcyBSZWNJdGVtczoKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBzZWxmLm5hbWUgPSAiIgogICAgICAgIHNlbGYuaXRlbSA9ICIiCgoKIiIiVmVyaWZpY2Egc2kgZWwgdmFsb3IgcGFzYWRvIHBvciBhcmd1bWVudG8gZXMgZGlmZXJlbnRlIGEgbGEgZGVsIGFudGVyaW9yIG11ZXN0cmVvLCBkZSBzZXIgYXNpIHJldG9ybmEgdHJ1ZSB5IGVzcGVyYSB1biB0aWVtcG8gdGltZVNlYyAoc2luIGJsb3F1ZW8pIHBhcmEgdm9sdmVyIGEgdmVyaWZpY2FyIGNhbWJpb3MKQXJnczoKICAgIG5hbWUtPiAgbm9tYnJlIGFzaWduYWRvIGEgZXN0ZSBhbCBpdGVtIGVuIGN1ZXN0aW9uLCBwdWVkZSBzZXIgY3VhbHF1aWVyYSwgcGVybyBjdWFuZG8gc2UgdHJhdGUgZGUgbG8gbWlzbW8gdGllbmUgcXVlIHNlciBpZ3VhbCBlbiBjYWRhIGxsYW1hZGEsIHBhcmEgcXVlIHRvbWUgZW4KICAgICAgICAgICAgY3VlbnRhIGVsIHZhbG9yIHkgdGllbXBvCiAgICBpdGVtVmFsdWUtPiBpdGVtIHF1ZSBzZSBxdWllcmUgdGVzdGVhcgogICAgdGltZVNlYy0+IHRpZW1wbyBlbiBtaWxpc2VndW5kbyBtaW5pbW8gZGUgZXNwYWNpbyBlbnRyZSBzYWxpZGFzIFRydWUgcGFyYSBwcm9jZXNhciBzaSBlcyBxdWUgcHJvY2VkZTogbm8gYmxvcXVlYSBwb3JxdWUgdXNhIDogdXRpbWUudGlja3NfbXMoKQoiIiIKCgpkZWYgSXNUaW1lVG9Mb2cobmFtZTogc3RyLCBpdGVtVmFsdWUsIHRpbWVTZWM6IGludCk6CiAgICBpZHggPSAtMQoKICAgIGNvdW50ID0gMAoKICAgIGlmIGxlbihpdGVtUmVjKSA+IDA6CiAgICAgICAgZm9yIGl0ZW0gaW4gaXRlbVJlYzoKICAgICAgICAgICAgaWYgbmFtZSA9PSBpdGVtLm5hbWU6CiAgICAgICAgICAgICAgICBpZHggPSBjb3VudAoKICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICBjb3VudCArPSAxCgogICAgaWYgaWR4ID09IC0xOgogICAgICAgIGl0ZW1SZWMuYXBwZW5kKFJlY0l0ZW1zKCkpCgogICAgICAgIGl0ZW1SZWNbLTFdLm5hbWUgPSBuYW1lCiAgICAgICAgaXRlbVJlY1stMV0uaXRlbSA9IGl0ZW1WYWx1ZQoKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGVsc2U6CiAgICAgICAgaWYgaXRlbVJlY1tpZHhdLml0ZW0gIT0gaXRlbVZhbHVlOgogICAgICAgICAgICBpZiBJc1RpbWVQcm9jZXNzKG5hbWUsIHRpbWVTZWMpOgogICAgICAgICAgICAgICAgaXRlbVJlY1tpZHhdLml0ZW0gPSBpdGVtVmFsdWUKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCgogICAgcmV0dXJuIEZhbHNlCgoKZGVmIFNwbGl0U3RyaW5nKGRhdGE6IHN0ciwgcG9zOiBpbnQsIHNlcF9pbml0OiBzdHIsIHNlcF9lbmQ6IHN0ciA9IE5vbmUpOgoKICAgIGNvdW50ID0gMAoKICAgIGkgPSAwCgogICAgd2hpbGUgY291bnQgPCBwb3M6CgogICAgICAgIGkgPSBkYXRhLmZpbmQoc2VwX2luaXQsIGkgKyAxKQoKICAgICAgICBpZiBpID49IDA6CgogICAgICAgICAgICBjb3VudCArPSAxCgogICAgICAgICAgICBpZiBjb3VudCA9PSBwb3M6CiAgICAgICAgICAgICAgICBpZiBzZXBfZW5kICE9IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgZSA9IGRhdGEuZmluZChzZXBfZW5kLCBpICsgMSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZSA9IGRhdGEuZmluZChzZXBfaW5pdCwgaSArIDEpCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRhdCA9IGRhdGFbaSArIDE6IGVdCgogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXQKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwcmludCgiZmFpbCIpCiAgICAgICAgICAgICAgICAgICAgcGFzcwoKICAgIHJldHVybiAibm9uZSIKCgpkZWYgZGVjaW1hbF9kZWdyZWVzKGRlZ3JlZXMsIG1pbnV0ZXMpOgogICAgcmV0dXJuIGRlZ3JlZXMgKyBtaW51dGVzLzYwCgoKZGVmIEdldERlY2ltYWxEZWdGcm9tR3BzRm9ybWF0KGRhdGE6IHN0ciwgaGVtOiBzdHIpOgoKICAgIGkgPSBkYXRhLmZpbmQoJy4nKQoKICAgIGRlZyA9IDAKICAgIG1pbiA9IDAKCiAgICBpZiBpID4gMDoKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBkZWcgPSBpbnQoZGF0YVswOmktMl0pCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgdHJ5OgogICAgICAgICAgICBtaW4gPSBmbG9hdChkYXRhW2ktMjpdKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKICAgICAgICB2YWwgPSBkZWNpbWFsX2RlZ3JlZXMoZGVnLCBtaW4pCgogICAgICAgIGlmIGhlbSA9PSAnUycgb3IgaGVtID09ICdXJzoKICAgICAgICAgICAgdmFsICo9IC0xCgogICAgICAgIHJldHVybiB2YWwKCiAgICByZXR1cm4gMAoKCmNsYXNzIFN0YXRlTGVkczoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBwaW4sIHN0YXRlX2xlZF9sb3c9MCwgc3RhdGVfbGVkX2hpZ2g9MCwgc2FtcGxlZF9tcz0xKToKICAgICAgICBzZWxmLnBpbiA9IFBpbihwaW4sIFBpbi5PVVQpCiAgICAgICAgc2VsZi5fX3N0YXRlX2xlZF9sb3cgPSBzdGF0ZV9sZWRfbG93CiAgICAgICAgc2VsZi5fX3N0YXRlX2xlZF9oaWdoID0gc3RhdGVfbGVkX2hpZ2gKICAgICAgICBzZWxmLnNhbXBsZWRfbXMgPSBzYW1wbGVkX21zCiAgICAgICAgc2VsZi5zdGF0ZV9sZWQgPSBGYWxzZQogICAgICAgIHNlbGYuY291bnRfc3RhdGVfbGVkID0gMAoKICAgIGRlZiBTZXRTdGF0ZXMoc2VsZiwgc3RhdGVfbGVkX2xvdywgc3RhdGVfbGVkX2hpZ2gpOgogICAgICAgIHNlbGYuc3RhdGVfbGVkX2xvdyA9IHN0YXRlX2xlZF9sb3cKICAgICAgICBzZWxmLnN0YXRlX2xlZF9oaWdoID0gc3RhdGVfbGVkX2hpZ2gKCiAgICBAcHJvcGVydHkKICAgIGRlZiBzdGF0ZV9sZWRfbG93KHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9fc3RhdGVfbGVkX2xvdwoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHN0YXRlX2xlZF9oaWdoKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLl9fc3RhdGVfbGVkX2hpZ2gKCiAgICBkZWYgU3RhdGVMZWQoc2VsZiwgc3RhdGVfbGVkX2xvdz0tMSwgc3RhdGVfbGVkX2hpZ2g9LTEpOgogICAgICAgIGlmIHN0YXRlX2xlZF9sb3cgPj0gMCBhbmQgc3RhdGVfbGVkX2hpZ2ggPj0gMDoKICAgICAgICAgICAgc2VsZi5fX3N0YXRlX2xlZF9sb3cgPSBzdGF0ZV9sZWRfbG93CiAgICAgICAgICAgIHNlbGYuX19zdGF0ZV9sZWRfaGlnaCA9IHN0YXRlX2xlZF9oaWdoCgogICAgICAgIGlmIHNlbGYuX19zdGF0ZV9sZWRfbG93ID4gMCBhbmQgc2VsZi5fX3N0YXRlX2xlZF9oaWdoID4gMDoKICAgICAgICAgICAgaWYgc2VsZi5zdGF0ZV9sZWQ6CiAgICAgICAgICAgICAgICBpZiBzZWxmLmNvdW50X3N0YXRlX2xlZCA+PSAoc2VsZi5fX3N0YXRlX2xlZF9oaWdoIC8gc2VsZi5zYW1wbGVkX21zKToKICAgICAgICAgICAgICAgICAgICBzZWxmLnBpbi5vZmYoKQoKICAgICAgICAgICAgICAgICAgICBzZWxmLnN0YXRlX2xlZCA9IEZhbHNlCgogICAgICAgICAgICAgICAgICAgIHNlbGYuY291bnRfc3RhdGVfbGVkID0gMAoKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIHNlbGYuY291bnRfc3RhdGVfbGVkID49IHNlbGYuX19zdGF0ZV9sZWRfbG93IC8gc2VsZi5zYW1wbGVkX21zOgogICAgICAgICAgICAgICAgICAgIHNlbGYucGluLm9uKCkKCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zdGF0ZV9sZWQgPSBUcnVlCgogICAgICAgICAgICAgICAgICAgIHNlbGYuY291bnRfc3RhdGVfbGVkID0gMAoKICAgICAgICAgICAgc2VsZi5jb3VudF9zdGF0ZV9sZWQgKz0gMQoKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBzZWxmLl9fc3RhdGVfbGVkX2hpZ2ggPiAwOgogICAgICAgICAgICAgICAgc2VsZi5waW4ub24oKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5waW4ub2ZmKCkKCgojIHJlZ2lvbiBzYW1wbGVzCiMgZnJvbSBzcmMubGlicyBpbXBvcnQgVXRpbAoKIyBjbGFzcyB0ZXN0OgojICAgICBkZWYgX19pbml0X18oc2VsZik6CiMgICAgICAgICBzZWxmLmRhdGEgPSAxMjMuNDU2Nzg5MTIzCiMgICAgICAgICBzZWxmLnBwID0gIkVzdG8gZXMgcHJ1ZWJhIgojICAgICAgICAgc2VsZi53dyA9IHsidmFsMSI6ICJhc2QiLCAidmFsMiI6IDEyM30KIyAgICAgICAgIHNlbGYucHJ1ZWJhID0gWzEsIDIuOSwgNC41LCA2LjcsIDQ1LjEsIDZdCiMgICAgICAgICBzZWxmLnR1cCA9IFs0NSwgInBlcGUiXQoKCiMgb2JqMSA9IHRlc3QoKQoKIyBzdHJkYXRhID0gVXRpbC5Db252ZXJ0SnNvbihvYmoxKQoKIyBwcmludChzdHJkYXRhKQoKIyBvYmoyID0gdGVzdCgpCgojIFV0aWwuRGVjb2RlSnNvblRvT2JqKHN0cmRhdGEsIG9iajIpCgojIHByaW50KG9iajIuZGF0YSkKCiMgcHJpbnQob2JqMi5fX2RpY3RfXykKCiMgZW5kcmVnaW9uCg=="}]}